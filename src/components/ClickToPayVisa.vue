<template>
  <div>
    <div id="buttonPaymentListContainer"></div>
    <textarea id="transientToken" name="transientToken" rows="25" cols="50"></textarea>
  </div>
</template>

<script setup>
import { onMounted } from 'vue';

const loadVisaClickToPay = async () => {
  console.log('Cargando script de VISA Click to Pay...');
  const script = document.createElement('script');
  script.src = 'https://apitest.cybersource.com/up/v1/assets/0.22.0/SecureAcceptance.js'; // clientLibrary obtenido de la captura de contexto
  script.async = true;
  script.onload = await onVisaClickToPayLoaded;
  script.onerror = function() {
    console.error('Error al cargar el script de VISA Click to Pay.');
  };
  document.head.appendChild(script);
};

const onVisaClickToPayLoaded = async () => {
  const captureContext = 'eyJraWQiOiJ6dSIsImFsZyI6IlJTMjU2In0.eyJmbHgiOnsicGF0aCI6Ii9mbGV4L3YyL3Rva2VucyIsImRhdGEiOiIya1V1MWI0RGNnQWdNRTNGUldJQ0lSQUFFT3VDSkQxdDZsUkFvMGRaYWRBZU9wL1RKNGV5eXdRWTJhV2JqWlkwUVFkSGxoVlV1U2pEYU1TRmJRdVRnMzBiUjhUeDh1MEpDNXpDeUF2b3A0d1liUktzRmJ3dlA3R3V1UWtLaEhlZXU1OStkQzB2M1FLcE0yYk5vQVJXSlE2VkFnXHUwMDNkXHUwMDNkIiwib3JpZ2luIjoiaHR0cHM6Ly90ZXN0ZmxleC5jeWJlcnNvdXJjZS5jb20iLCJ0cmFuc2llbnRUb2tlbk9wZXJhdGlvbnMiOlt7InN1YiI6InRlc3RnZXRuZXRjbF9zYW5kYm94MDAxIiwiYXVkIjoiZ2V0bmV0Y2xfc2FuZGJveCIsImtpZCI6ImUwNDQ5YWU4LTUxZDgtNDQ0MC1iN2IzLWJiODQxYWYzNjIwMiIsInR5cGUiOiJTVE9SRSJ9XSwiandrIjp7Imt0eSI6IlJTQSIsImUiOiJBUUFCIiwidXNlIjoiZW5jIiwibiI6ImphVll5QWZVUjJoUEJwaFdEZVR6b083YkN1R3ZMVkptMWphQmxEMTRHT00zR3h5b3dydmgtVkFpZmZfWGRWclkyd2NBS3F2YThiZTRpZmxWSnFyWjlwTHh4b3BBeXhUWGJSOXV6cUJqQmNseFNBZGQ0ZG1OU05lSEIzUWdBcDRHbkpoQ3JwRlpnYTlvWlZrS1pabGFOcWJ6Ty1oYTZtNFdqYnBzMno4TTM3VnZCSTdDMU1KWG5adGlvV3Qza1pHM2hnVGZsT0lxYnJpUkFOVjJuWHBYSDNBOV95MkJyNUJHd1l5d1dLbE45dUhIUjhVRmNodGtPQTU5WFRQU2gtSzhNMUl5bGtGMURtbWo4TjAybUtfd3FQLUE3OEdFRERIUnZwV25qX2Zka1dYc3N5R3JBSmlxRkg4d1AtUXVubHR4NFBIZFlmYWM1SDVrdUJONkNnRnh4dyIsImtpZCI6IjA4OWNwN281SXNUa3kwNjgwelVQZUtPVGxGRVI5ODBIIn19LCJjdHgiOlt7ImRhdGEiOnsiYWxsb3dlZFBheW1lbnRUeXBlcyI6W3sicGFnZSI6MSwidHlwZSI6IlBBTkVOVFJZIn0seyJwYWdlIjoyLCJ0eXBlIjoiQ0xJQ0tUT1BBWSJ9LHsicGFnZSI6MywidHlwZSI6IlNSQ1ZJU0EifSx7InBhZ2UiOjQsInR5cGUiOiJTUkNNQVNURVJDQVJEIn0seyJwYWdlIjo1LCJ0eXBlIjoiU1JDQU1FWCJ9XSwicGF5bWVudENvbmZpZ3VyYXRpb25zIjp7IlNSQ1ZJU0EiOnsib3JpZ2luIjoiaHR0cHM6Ly9zYW5kYm94LWFzc2V0cy5zZWN1cmUuY2hlY2tvdXQudmlzYS5jb20iLCJwYXRoIjoiL2NoZWNrb3V0LXdpZGdldC9yZXNvdXJjZXMvanMvc3JjLWktYWRhcHRlci92aXNhU2RrLmpzP3YyIiwicGFuRW5jcnlwdGlvbktleSI6eyJrdHkiOiJSU0EiLCJlIjoiQVFBQiIsInVzZSI6ImVuYyIsImtpZCI6IjNHUFdQVkkzRVNXM0dDSlMyWTVGMTNhZVVZbEtUVlRoWGlTMlRLbllLRXRMbC1RRU0iLCJuIjoic1pQSXVzRGY3eVFubmhCa1U5bXUxNFZPTzNDcnVpM2I3ckFmMktZZW9iVVJtWEExN2IxSlg5amcwQ2QtdmdwbXV5VHJ4QlVTYy00YjAtVVBnU3dHRnFQV1VweDA4RXhxcndQRE92Rm9qQm91MndseXE4YmN5MFVzLUJmZUN6U0U1bE1WZFNYVFhYWGNOcXUtcWIyMmpDQ0NKQUxweHNBcnNib01PWHNMZWRoM000WE5RNVhHQXRSZjdiLS11VFk1RHI5S0xZeVV2WktBblkwNE1LSlBFTzU0WWlJRk01RFRBaE5PbXMwODlqZE1keC1VUklLSmpQVTItUnBIRzF1OExDRzAyOFJUSXBQc05iUmFudVM1VEFZX3pseERnYjFoS0ozNlliWkVOSExnOVBYVEJoZE9NbFU5MERUTGxmY2JMVGEtRDdEZ2xqQWFXQ3V2ekxQYUd3In0sInBhcmFtZXRlcnMiOnsic3JjSW5pdGlhdG9ySWQiOiJKRkNaOFFWT0pBNzZOWFo2OEZaRDIxUllJeGozeVBaZGlVeGtkTnVpYkJseGd3YVA0Iiwic3JjaURwYUlkIjoiYTAxZWUyMGUtYTZlOC00Mjc4LWI0ZGYtOTE1MjJmMzI4ODg3Iiwic3JjaVRyYW5zYWN0aW9uSWQiOiJiZmZjY2MxNC00MmM1LTRiOWItYWZlMC0yMDcxYzBhOTQzYjYiLCJkcGFUcmFuc2FjdGlvbk9wdGlvbnMiOnsiZHBhTG9jYWxlIjoiZXNfQ08iLCJwYXlsb2FkVHlwZUluZGljYXRvciI6IkZVTEwiLCJyZXZpZXdBY3Rpb24iOiJjb250aW51ZSIsImRwYUFjY2VwdGVkQmlsbGluZ0NvdW50cmllcyI6W10sImRwYUFjY2VwdGVkU2hpcHBpbmdDb3VudHJpZXMiOlsiVVMiLCJHQiJdLCJkcGFCaWxsaW5nUHJlZmVyZW5jZSI6IkFMTCIsImRwYVNoaXBwaW5nUHJlZmVyZW5jZSI6Ik5PTkUiLCJjb25zdW1lck5hbWVSZXF1ZXN0ZWQiOnRydWUsImNvbnN1bWVyRW1haWxBZGRyZXNzUmVxdWVzdGVkIjpmYWxzZSwiY29uc3VtZXJQaG9uZU51bWJlclJlcXVlc3RlZCI6ZmFsc2UsIm1lcmNoYW50Q291bnRyeUNvZGUiOiJDTyIsImN1c3RvbUlucHV0RGF0YSI6eyJjaGVja291dE9yY2hlc3RyYXRvciI6Im1lcmNoYW50In0sInRyYW5zYWN0aW9uQW1vdW50Ijp7InRyYW5zYWN0aW9uQW1vdW50IjoiMjAwMDAiLCJ0cmFuc2FjdGlvbkN1cnJlbmN5Q29kZSI6IkNPUCJ9LCJwYXltZW50T3B0aW9ucyI6eyJkcGFEeW5hbWljRGF0YVR0bE1pbnV0ZXMiOjE1LCJkcGFQYW5SZXF1ZXN0ZWQiOmZhbHNlLCJkeW5hbWljRGF0YVR5cGUiOiJDQVJEX0FQUExJQ0FUSU9OX0NSWVBUT0dSQU1fTE9OR19GT1JNIn19fX0sIlNSQ01BU1RFUkNBUkQiOnsib3JpZ2luIjoiaHR0cHM6Ly9zYW5kYm94LnNyYy5tYXN0ZXJjYXJkLmNvbSIsInBhdGgiOiIvc2RrL3NyY3Nkay5tYXN0ZXJjYXJkLmpzIiwicGFuRW5jcnlwdGlvbktleSI6eyJrdHkiOiJSU0EiLCJlIjoiQVFBQiIsInVzZSI6ImVuYyIsImtpZCI6IjIwMjMwMjA3MjIzNTIxLXNhbmRib3gtZnBhbi1lbmNyeXB0aW9uLXNyYy1tYXN0ZXJjYXJkLWludCIsImtleV9vcHMiOlsiZW5jcnlwdCIsIndyYXBLZXkiXSwiYWxnIjoiUlNBLU9BRVAtMjU2IiwibiI6InQwNkk4c2psUy1ycnM3dUNhZ0g4ZXZvZXVtYVJvdkt6aVpTSTlTMk45SURROXRXMlBhcGZSYTlMYzFLdmVFQkRWczI3UGtoa1U1T3lIZ1AwaUVqVHVLVnB2aDU5VDRsYS1tQlNJbHM3VWVjVVFMTGEwV2ttYnRMN2pOZGx0QTVmcTdBaGNBcjVxY2E5ODhxckxkN0l5cjlFMEMzVHhiVDl0bzFpUWNwejhvY1pPRFJYb2lkRkFuT1ZMNVlHRm1sc3JlRGJKNFZoc2kwcEFkY2NRY2lsLXlkU2d1cktCLXJxS3BwYjllcG9tdTRRVWgzMzgyQ3Y4Tm9iWW1GM29zOG5HR2dHUC1jeVhvMG5zS2NQQWdmcmxRem9zN3FIeFVPckZlMnhfbFoxRzFBRS1YcmtyeGpCeXM5cTUzR01SU05DUThjLV9tY0Y5cGJxNEhZQnMtdkQ1USJ9LCJwYXJhbWV0ZXJzIjp7InNyY2lUcmFuc2FjdGlvbklkIjoiYmZmY2NjMTQtNDJjNS00YjliLWFmZTAtMjA3MWMwYTk0M2I2Iiwic3JjaURwYUlkIjoiYTAxZWUyMGUtYTZlOC00Mjc4LWI0ZGYtOTE1MjJmMzI4ODg3Iiwic3JjSW5pdGlhdG9ySWQiOiI4NDRmN2UzZC0wN2YwLTQ0YjEtYTIzNy1lNjQyNDQ0ZTA1MTIiLCJkcGFUcmFuc2FjdGlvbk9wdGlvbnMiOnsidHJhbnNhY3Rpb25UeXBlIjoiUFVSQ0hBU0UiLCJkcGFMb2NhbGUiOiJlc19DTyIsImRwYUFjY2VwdGVkU2hpcHBpbmdDb3VudHJpZXMiOlsiVVMiLCJHQiJdLCJjb25zdW1lckVtYWlsQWRkcmVzc1JlcXVlc3RlZCI6ZmFsc2UsImNvbnN1bWVyUGhvbmVOdW1iZXJSZXF1ZXN0ZWQiOmZhbHNlLCJ0cmFuc2FjdGlvbkFtb3VudCI6eyJ0cmFuc2FjdGlvbkFtb3VudCI6IjIwMDAwIiwidHJhbnNhY3Rpb25DdXJyZW5jeUNvZGUiOiJDT1AifSwiZHBhQWNjZXB0ZWRCaWxsaW5nQ291bnRyaWVzIjpbXSwiZHBhQmlsbGluZ1ByZWZlcmVuY2UiOiJGVUxMIiwiZHBhU2hpcHBpbmdQcmVmZXJlbmNlIjoiTk9ORSIsImNvbnN1bWVyTmFtZVJlcXVlc3RlZCI6dHJ1ZSwicGF5bG9hZFR5cGVJbmRpY2F0b3IiOiJGVUxMIiwicGF5bWVudE9wdGlvbnMiOnsiZHluYW1pY0RhdGFUeXBlIjoiQ0FSRF9BUFBMSUNBVElPTl9DUllQVE9HUkFNX1NIT1JUX0ZPUk0ifX19fSwiU1JDQU1FWCI6eyJvcmlnaW4iOiJodHRwczovL3F3d3cuYWV4cC1zdGF0aWMuY29tIiwicGF0aCI6Ii9ha2FtYWkvcmVtb3RlY29tbWVyY2Uvc2NyaXB0cy9hbWV4U0RLLTEuMC4wLmpzIiwicGFuRW5jcnlwdGlvbktleSI6eyJrdHkiOiJSU0EiLCJlIjoiQVFBQiIsInVzZSI6ImVuYyIsImtpZCI6InNyYy1hbWV4LWNhcmQtZW5jLTIwMjQiLCJhbGciOiJSU0EtT0FFUC0yNTYiLCJuIjoibUVrMGJtTEMyWlFXLWE0S1gxbkRZM1pmUExGckg4dG5VeUliNWtUS2d6YWVhZ2ltYUg0WHFQNFp3MDVpaTZNdmR2TjBUMnB5U0pRNGpva2hQQzJJV2VtaVZQRzhmQ1BCTUp4eGp5MkV1OW90Yml3R1JCQ2d4d2N1LWFjallhdXBWUHRETjdlbmdIRGRuT2dhcmxvR3JQVU02SUVFWldfdkVCOWNTck1fQmE4U2NDOFJhZmdOU1k4MWl4YXhQQThjT2hBQXZyTFE3S2hFNVF4U3pJTWZyemIxTEJZR0w0WVBCdW5mTkEydzNmdkx3ZkJsMl8tUkZSQ1VtUEV2MU51WHF4bzFSTjA4ajJ1bjhlaWNHdm50MGd0LTIxbkdyYmM2eHBwN3BaWTJvai1oYzBaVWxOeUVfa0pwTFM1T1VaOEdlT1pwNHFWUnhoa0lQR3hFZUYtUVdpU2c4dVdrMXg2bmN0aHJNVUpZVjFIUHU4dEhrSkRtOEFhLURzaFBOZWl4RGpfVkZWRVM4Vi15SUlSd2ctVTI4MldQYjBUMnRLUlhkbmpsTnZjbEJzSV80VndnNWNXRWhTa1NzelVBeTFQQ1NGbmtaNUlFT3JoZ18wVHBlN2FpTzh3NXNSd05oWm5ScEp5SXNQdC1sTUNvN3pyODVCMnZ4Y29QZmZTU3AzRloifSwicGFyYW1ldGVycyI6eyJzcmNpVHJhbnNhY3Rpb25JZCI6ImJmZmNjYzE0LTQyYzUtNGI5Yi1hZmUwLTIwNzFjMGE5NDNiNiIsInNyY0luaXRpYXRvcklkIjoiOGVjMmM4ODgtNjRjYy00ZWZjLTkxNzUtYjMzNzQ1MmIyOGM4IiwiZHBhRGF0YSI6eyJkcGFOYW1lIjoiR0VUTkVUIENISUxFIFMuQS4iLCJkcGFMb2dvVXJpIjoiaHR0cHM6Ly93d3cuZ2V0bmV0LmNsLyIsImRwYVByZXNlbnRhdGlvbk5hbWUiOiJHRVRORVQgQ0hJTEUgUy5BLiIsImRwYVVyaSI6Imh0dHBzOi8vd3d3LmdldG5ldC5jbC8ifSwiZHBhVHJhbnNhY3Rpb25PcHRpb25zIjp7ImRwYUxvY2FsZSI6ImVzX0NPIiwiZHBhQWNjZXB0ZWRCaWxsaW5nQ291bnRyaWVzIjpbXSwiZHBhQWNjZXB0ZWRTaGlwcGluZ0NvdW50cmllcyI6WyJVUyIsIkdCIl0sImRwYUJpbGxpbmdQcmVmZXJlbmNlIjoiQUxMIiwiZHBhU2hpcHBpbmdQcmVmZXJlbmNlIjoiTk9ORSIsImNvbnN1bWVyTmFtZVJlcXVlc3RlZCI6dHJ1ZSwiY29uc3VtZXJFbWFpbEFkZHJlc3NSZXF1ZXN0ZWQiOmZhbHNlLCJjb25zdW1lclBob25lTnVtYmVyUmVxdWVzdGVkIjpmYWxzZSwicmV2aWV3QWN0aW9uIjoiY29udGludWUiLCJ0aHJlZURzUHJlZmVyZW5jZSI6Ik5PTkUifX19fSwiY2FwdHVyZU1hbmRhdGUiOnsiYmlsbGluZ1R5cGUiOiJGVUxMIiwicmVxdWVzdEVtYWlsIjpmYWxzZSwicmVxdWVzdFBob25lIjpmYWxzZSwicmVxdWVzdFNoaXBwaW5nIjpmYWxzZSwic2hpcFRvQ291bnRyaWVzIjpbIlVTIiwiR0IiXSwic2hvd0FjY2VwdGVkTmV0d29ya0ljb25zIjp0cnVlfSwib3JkZXJJbmZvcm1hdGlvbiI6eyJhbW91bnREZXRhaWxzIjp7InRvdGFsQW1vdW50IjoiMjAwMDAiLCJjdXJyZW5jeSI6IkNPUCJ9fSwidGFyZ2V0T3JpZ2lucyI6WyJodHRwczovL3BvYy1sZW1vbi1maXZlLnZlcmNlbC5hcHAiXSwiaWZyYW1lcyI6eyJtY2UiOiIvbWNlL21jZS5odG1sIiwiYnV0dG9ucyI6Ii9idXR0b25saXN0L2J1dHRvbmxpc3QuaHRtbCIsInNyYyI6Ii9zZWN1cmUtcmVtb3RlLWNvbW1lcmNlL3NyYy5odG1sIiwiY3RwIjoiL2N0cC9jdHAuaHRtbCIsImdvb2dsZXBheSI6Ii9nb29nbGVwYXkvZ29vZ2xlcGF5Lmh0bWwiLCJhcHBsZXBheSI6Ii9hcHBsZXBheS9hcHBsZXBheS5odG1sIiwicGF6ZSI6Ii9wYXplL3BhemUuaHRtbCIsImNoZWNrIjoiL2NoZWNrL2NoZWNrLmh0bWwifSwiY2xpZW50VmVyc2lvbiI6IjAuMjIiLCJjb3VudHJ5IjoiQ08iLCJsb2NhbGUiOiJlc19DTyIsImFsbG93ZWRDYXJkTmV0d29ya3MiOlsiVklTQSIsIk1BU1RFUkNBUkQiLCJBTUVYIl0sImNyIjoiMXlacHRMdHNMNEFCTjJ6WHRSSUdMV2FiMGljNWkyWG1xQUhsdE10TnFJNVFWMjNWVXJSNjZ4aE9kNzRpVzZGVDVLUkg2Z0lpRDhCS2ZTWXdQNGRaTnE0LU1YWmVqLUlYT3hBQTJtc2l0TFN1S01mam5vQmJ4Z3lxIiwic2VydmljZU9yaWdpbiI6Imh0dHBzOi8vYXBpdGVzdC5jeWJlcnNvdXJjZS5jb20iLCJjbGllbnRMaWJyYXJ5IjoiaHR0cHM6Ly9hcGl0ZXN0LmN5YmVyc291cmNlLmNvbS91cC92MS9hc3NldHMvMC4yMi4yL1NlY3VyZUFjY2VwdGFuY2UuanMiLCJsb2dnaW5nUGF0aCI6Ii91cC92MS9sb2ctZXZlbnRzIiwiYXNzZXRzUGF0aCI6Ii91cC92MS9hc3NldHMvMC4yMi4yIiwiY2xpZW50TGlicmFyeUludGVncml0eSI6InNoYTI1Ni1tOWNCTUoxa3RwMGFWYnBJazYza3RiS0Z0ZWlqR04wOUZvdGNuMnUzUVlzXHUwMDNkIn0sInR5cGUiOiJnZGEtMC45LjAifV0sImlzcyI6IkZsZXggQVBJIiwiZXhwIjoxNzMwMjk5ODMxLCJpYXQiOjE3MzAyOTg5MzEsImp0aSI6ImYwYXFGam9KTmlsVjJLWUcifQ.hlaX6unQnEyWVpL3QXG4AVSr6CUbJDbNcLqCoOXORBV2i6NVjgYj7fcvHVwONKb3YODs9EgXJ67h317SRpvHmHr-hsv5T78mIfRPrLeCblqnO7frrRPk3MTMTjPRF6QbjMBvk53ljlEhmIRo4D-ZBs-OvxPM_c3dld6KQQdsxCdHd6N-UB69DwdlrmRMLSCrRAFd9RSfrc8QMk6OBNq8u0PK4rPGBToSU15ZwkjyBCepl1n7bk13HKJ4WJj_XbMfEn5JfH8LUWcdLmyrE_CPX37QqmvSTEmOPjYKB1MAF_vJ08rlnszMoDLB2F-X96KSOTmc64gO2Gz14-aOjvmwVQ';
  const showArgs = {
    containers: {
      paymentSelection: "#buttonPaymentListContainer"
    }
  };

  Accept(captureContext)
      .then(accept => accept.unifiedPayments())
      .then(up => up.show(showArgs))
      .then(tt => {
        const transientToken = document.getElementById('transientToken');
        transientToken.value = tt;

        console.log('tt:', tt);
      })
      .catch(error => {
        console.error("Error en el flujo de Click to Pay:", error);
      });

  console.log('cargado script de VISA Click to Pay');
};

onMounted(() => {
  console.log('Actualizado el 30 de octubre a las 09:35 am')
  loadVisaClickToPay();
});
</script>
