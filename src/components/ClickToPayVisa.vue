<template>
  <div>
    <div id="buttonPaymentListContainer"></div>
    <form id="authForm" action="/process-payment" method="POST">
      <input type="hidden" id="transientToken" name="transientToken" />
    </form>
  </div>
</template>

<script setup>
import { onMounted } from 'vue';

const loadVisaClickToPay = async () => {
  console.log('Cargando script de VISA Click to Pay...');
  const script = document.createElement('script');
  script.src = 'https://apitest.cybersource.com/up/v1/assets/0.11.0/SecureAcceptance.js'; // clientLibrary obtenido de la captura de contexto
  script.async = true;
  script.onload = await onVisaClickToPayLoaded;
  script.onerror = function() {
    console.error('Error al cargar el script de VISA Click to Pay.');
  };
  document.head.appendChild(script);
};

const onVisaClickToPayLoaded = async () => {
  const captureContext = 'eyJraWQiOiJ6dSIsImFsZyI6IlJTMjU2In0.eyJmbHgiOnsicGF0aCI6Ii9mbGV4L3YyL3Rva2VucyIsImRhdGEiOiJ2SmMvV05oZnlGL0dQNEVVNTVQWjBSQUFFRjJVSUk1RFhDL25md1Y5ZVR1MWFFSi9UWlVJWUxsL3hkMlJ2bWNKN2JValVxVm0rMVN3U2dKaWRYa3hXU2kwajA0U2huaFdOQURxV242SlVTaXRWdUppMk1aVW10VG41WXhod01IankxN3o2TzBMdzU2VitpK1hVZVk2elZZZTJnXHUwMDNkXHUwMDNkIiwib3JpZ2luIjoiaHR0cHM6Ly90ZXN0ZmxleC5jeWJlcnNvdXJjZS5jb20iLCJqd2siOnsia3R5IjoiUlNBIiwiZSI6IkFRQUIiLCJ1c2UiOiJlbmMiLCJuIjoidVI3Z1VRcFNKVXZmTl8xRHV3Wk1mZXExS2Z3Z3NPOWxDZVpERk1IV1ZORVhScmlDUXAxbDBzeURDR20wZExNYlFZT0hMbEprdThMZmNXb1hveXJQWVZnMGRQRXFwMHh2dVVTdVFodkpqM0xnRHJyTk5WVWJOLWVheXVqdjJnd2FLSjRLLTNhX1p6dHRvMUFDRzV2SXRKektlRklZdlUydkJlNGR6M0lmbjFBZEpRUGZ1Ynd3b3NrcXVxUDJuZzZEdktjRkdGU1VtZ012RUtkYk1hNjJtRzVLTER2Z3hYd0Rod2Z0TFpfbjZDREtuaDNxeEJuVUVLRXc3akNGTWFyN09CU0JtN2hfdXp0TTJIMTMxT09PN3pzTENPaEgzeU93bGwzYTB2N0txaXlUYlBER01UYnMxZnlJd0N2bDc5SFRadU04Z05aOXVxdE5pU1dsM1pxR1hRIiwia2lkIjoiMDhia2ZYTUo3V2tZVWNZbnM4OGtqVlBHYTNEa09BMFcifX0sImN0eCI6W3siZGF0YSI6eyJhbGxvd2VkUGF5bWVudFR5cGVzIjpbeyJwYWdlIjoxLCJ0eXBlIjoiUEFORU5UUlkifSx7InBhZ2UiOjIsInR5cGUiOiJTUkNWSVNBIn0seyJwYWdlIjozLCJ0eXBlIjoiU1JDTUFTVEVSQ0FSRCJ9LHsicGFnZSI6NCwidHlwZSI6IlNSQ0FNRVgifV0sInBheW1lbnRDb25maWd1cmF0aW9ucyI6eyJTUkNWSVNBIjp7Im9yaWdpbiI6Imh0dHBzOi8vc2FuZGJveC1hc3NldHMuc2VjdXJlLmNoZWNrb3V0LnZpc2EuY29tIiwicGF0aCI6Ii9jaGVja291dC13aWRnZXQvcmVzb3VyY2VzL2pzL3NyYy1pLWFkYXB0ZXIvdmlzYVNkay5qcyIsInBhbkVuY3J5cHRpb25LZXkiOnsia3R5IjoiUlNBIiwiZSI6IkFRQUIiLCJ1c2UiOiJlbmMiLCJraWQiOiIzR1BXUFZJM0VTVzNHQ0pTMlk1RjEzYWVVWWxLVFZUaFhpUzJUS25ZS0V0TGwtUUVNIiwibiI6InNaUEl1c0RmN3lRbm5oQmtVOW11MTRWT08zQ3J1aTNiN3JBZjJLWWVvYlVSbVhBMTdiMUpYOWpnMENkLXZncG11eVRyeEJVU2MtNGIwLVVQZ1N3R0ZxUFdVcHgwOEV4cXJ3UERPdkZvakJvdTJ3bHlxOGJjeTBVcy1CZmVDelNFNWxNVmRTWFRYWFhjTnF1LXFiMjJqQ0NDSkFMcHhzQXJzYm9NT1hzTGVkaDNNNFhOUTVYR0F0UmY3Yi0tdVRZNURyOUtMWXlVdlpLQW5ZMDRNS0pQRU81NFlpSUZNNURUQWhOT21zMDg5amRNZHgtVVJJS0pqUFUyLVJwSEcxdThMQ0cwMjhSVElwUHNOYlJhbnVTNVRBWV96bHhEZ2IxaEtKMzZZYlpFTkhMZzlQWFRCaGRPTWxVOTBEVExsZmNiTFRhLUQ3RGdsakFhV0N1dnpMUGFHdyJ9LCJwYXJhbWV0ZXJzIjp7InNyY0luaXRpYXRvcklkIjoiSkZDWjhRVk9KQTc2TlhaNjhGWkQyMVJZSXhqM3lQWmRpVXhrZE51aWJCbHhnd2FQNCIsInNyY2lEcGFJZCI6ImEwMWVlMjBlLWE2ZTgtNDI3OC1iNGRmLTkxNTIyZjMyODg4NyIsInNyY2lUcmFuc2FjdGlvbklkIjoiZTI3NTEyMmYtNDRhMy00YjI3LWE5ZjItZjRiYjBkOTNhNDIwIiwiZHBhVHJhbnNhY3Rpb25PcHRpb25zIjp7ImRwYUxvY2FsZSI6ImVuX1VTIiwicGF5bG9hZFR5cGVJbmRpY2F0b3IiOiJGVUxMIiwicmV2aWV3QWN0aW9uIjoiY29udGludWUiLCJkcGFBY2NlcHRlZEJpbGxpbmdDb3VudHJpZXMiOltdLCJkcGFBY2NlcHRlZFNoaXBwaW5nQ291bnRyaWVzIjpbIlVTIiwiR0IiXSwiZHBhQmlsbGluZ1ByZWZlcmVuY2UiOiJBTEwiLCJkcGFTaGlwcGluZ1ByZWZlcmVuY2UiOiJBTEwiLCJjb25zdW1lck5hbWVSZXF1ZXN0ZWQiOnRydWUsImNvbnN1bWVyRW1haWxBZGRyZXNzUmVxdWVzdGVkIjp0cnVlLCJjb25zdW1lclBob25lTnVtYmVyUmVxdWVzdGVkIjp0cnVlLCJ0cmFuc2FjdGlvbkFtb3VudCI6eyJ0cmFuc2FjdGlvbkFtb3VudCI6IjIxLjAwIiwidHJhbnNhY3Rpb25DdXJyZW5jeUNvZGUiOiJVU0QifSwicGF5bWVudE9wdGlvbnMiOnsiZHBhRHluYW1pY0RhdGFUdGxNaW51dGVzIjoxNSwiZHBhUGFuUmVxdWVzdGVkIjpmYWxzZSwiZHluYW1pY0RhdGFUeXBlIjoiVEFWViJ9fX19LCJTUkNNQVNURVJDQVJEIjp7Im9yaWdpbiI6Imh0dHBzOi8vc2FuZGJveC5zcmMubWFzdGVyY2FyZC5jb20iLCJwYXRoIjoiL3Nkay9zcmNzZGsubWFzdGVyY2FyZC5qcyIsInBhbkVuY3J5cHRpb25LZXkiOnsia3R5IjoiUlNBIiwiZSI6IkFRQUIiLCJ1c2UiOiJlbmMiLCJraWQiOiIyMDIzMDIwNzIyMzUyMS1zYW5kYm94LWZwYW4tZW5jcnlwdGlvbi1zcmMtbWFzdGVyY2FyZC1pbnQiLCJrZXlfb3BzIjpbImVuY3J5cHQiLCJ3cmFwS2V5Il0sImFsZyI6IlJTQS1PQUVQLTI1NiIsIm4iOiJ0MDZJOHNqbFMtcnJzN3VDYWdIOGV2b2V1bWFSb3ZLemlaU0k5UzJOOUlEUTl0VzJQYXBmUmE5TGMxS3ZlRUJEVnMyN1BraGtVNU95SGdQMGlFalR1S1Zwdmg1OVQ0bGEtbUJTSWxzN1VlY1VRTExhMFdrbWJ0TDdqTmRsdEE1ZnE3QWhjQXI1cWNhOTg4cXJMZDdJeXI5RTBDM1R4YlQ5dG8xaVFjcHo4b2NaT0RSWG9pZEZBbk9WTDVZR0ZtbHNyZURiSjRWaHNpMHBBZGNjUWNpbC15ZFNndXJLQi1ycUtwcGI5ZXBvbXU0UVVoMzM4MkN2OE5vYlltRjNvczhuR0dnR1AtY3lYbzBuc0tjUEFnZnJsUXpvczdxSHhVT3JGZTJ4X2xaMUcxQUUtWHJrcnhqQnlzOXE1M0dNUlNOQ1E4Yy1fbWNGOXBicTRIWUJzLXZENVEifSwicGFyYW1ldGVycyI6eyJzcmNpVHJhbnNhY3Rpb25JZCI6ImUyNzUxMjJmLTQ0YTMtNGIyNy1hOWYyLWY0YmIwZDkzYTQyMCIsInNyY2lEcGFJZCI6ImEwMWVlMjBlLWE2ZTgtNDI3OC1iNGRmLTkxNTIyZjMyODg4NyIsInNyY0luaXRpYXRvcklkIjoiODQ0ZjdlM2QtMDdmMC00NGIxLWEyMzctZTY0MjQ0NGUwNTEyIiwiZHBhVHJhbnNhY3Rpb25PcHRpb25zIjp7InRyYW5zYWN0aW9uVHlwZSI6IlBVUkNIQVNFIiwiZHBhTG9jYWxlIjoiZW5fVVMiLCJkcGFBY2NlcHRlZFNoaXBwaW5nQ291bnRyaWVzIjpbIlVTIiwiR0IiXSwiY29uc3VtZXJFbWFpbEFkZHJlc3NSZXF1ZXN0ZWQiOnRydWUsImNvbnN1bWVyUGhvbmVOdW1iZXJSZXF1ZXN0ZWQiOnRydWUsInRyYW5zYWN0aW9uQW1vdW50Ijp7InRyYW5zYWN0aW9uQW1vdW50IjoiMjEuMDAiLCJ0cmFuc2FjdGlvbkN1cnJlbmN5Q29kZSI6IlVTRCJ9LCJkcGFBY2NlcHRlZEJpbGxpbmdDb3VudHJpZXMiOltdLCJkcGFCaWxsaW5nUHJlZmVyZW5jZSI6IkZVTEwiLCJkcGFTaGlwcGluZ1ByZWZlcmVuY2UiOiJGVUxMIiwiY29uc3VtZXJOYW1lUmVxdWVzdGVkIjp0cnVlLCJwYXlsb2FkVHlwZUluZGljYXRvciI6IkZVTEwiLCJwYXltZW50T3B0aW9ucyI6eyJkeW5hbWljRGF0YVR5cGUiOiJDQVJEX0FQUExJQ0FUSU9OX0NSWVBUT0dSQU1fU0hPUlRfRk9STSJ9fX19LCJTUkNBTUVYIjp7Im9yaWdpbiI6Imh0dHBzOi8vcXd3dy5hZXhwLXN0YXRpYy5jb20iLCJwYXRoIjoiL2FrYW1haS9yZW1vdGVjb21tZXJjZS9zY3JpcHRzL2FtZXhTREstMS4wLjAuanMiLCJwYW5FbmNyeXB0aW9uS2V5Ijp7Imt0eSI6IlJTQSIsImUiOiJBUUFCIiwidXNlIjoiZW5jIiwia2lkIjoic3JjLWFtZXgtY2FyZC1lbmMtMjAyNCIsImFsZyI6IlJTQS1PQUVQLTI1NiIsIm4iOiJtRWswYm1MQzJaUVctYTRLWDFuRFkzWmZQTEZySDh0blV5SWI1a1RLZ3phZWFnaW1hSDRYcVA0WncwNWlpNk12ZHZOMFQycHlTSlE0am9raFBDMklXZW1pVlBHOGZDUEJNSnh4ankyRXU5b3RiaXdHUkJDZ3h3Y3UtYWNqWWF1cFZQdERON2VuZ0hEZG5PZ2FybG9HclBVTTZJRUVaV192RUI5Y1NyTV9CYThTY0M4UmFmZ05TWTgxaXhheFBBOGNPaEFBdnJMUTdLaEU1UXhTeklNZnJ6YjFMQllHTDRZUEJ1bmZOQTJ3M2Z2THdmQmwyXy1SRlJDVW1QRXYxTnVYcXhvMVJOMDhqMnVuOGVpY0d2bnQwZ3QtMjFuR3JiYzZ4cHA3cFpZMm9qLWhjMFpVbE55RV9rSnBMUzVPVVo4R2VPWnA0cVZSeGhrSVBHeEVlRi1RV2lTZzh1V2sxeDZuY3Rock1VSllWMUhQdTh0SGtKRG04QWEtRHNoUE5laXhEal9WRlZFUzhWLXlJSVJ3Zy1VMjgyV1BiMFQydEtSWGRuamxOdmNsQnNJXzRWd2c1Y1dFaFNrU3N6VUF5MVBDU0Zua1o1SUVPcmhnXzBUcGU3YWlPOHc1c1J3TmhablJwSnlJc1B0LWxNQ283enI4NUIydnhjb1BmZlNTcDNGWiJ9LCJwYXJhbWV0ZXJzIjp7InNyY2lUcmFuc2FjdGlvbklkIjoiZTI3NTEyMmYtNDRhMy00YjI3LWE5ZjItZjRiYjBkOTNhNDIwIiwic3JjSW5pdGlhdG9ySWQiOiI4ZWMyYzg4OC02NGNjLTRlZmMtOTE3NS1iMzM3NDUyYjI4YzgiLCJkcGFEYXRhIjp7ImRwYU5hbWUiOiJHRVRORVQgQ0hJTEUgUy5BLiIsImRwYUxvZ29VcmkiOiJodHRwczovL3d3dy5nZXRuZXQuY2wvIiwiZHBhUHJlc2VudGF0aW9uTmFtZSI6IkdFVE5FVCBDSElMRSBTLkEuIiwiZHBhVXJpIjoiaHR0cHM6Ly93d3cuZ2V0bmV0LmNsLyJ9LCJkcGFUcmFuc2FjdGlvbk9wdGlvbnMiOnsiZHBhTG9jYWxlIjoiZW5fVVMiLCJkcGFBY2NlcHRlZEJpbGxpbmdDb3VudHJpZXMiOltdLCJkcGFBY2NlcHRlZFNoaXBwaW5nQ291bnRyaWVzIjpbIlVTIiwiR0IiXSwiZHBhQmlsbGluZ1ByZWZlcmVuY2UiOiJBTEwiLCJkcGFTaGlwcGluZ1ByZWZlcmVuY2UiOiJBTEwiLCJjb25zdW1lck5hbWVSZXF1ZXN0ZWQiOnRydWUsImNvbnN1bWVyRW1haWxBZGRyZXNzUmVxdWVzdGVkIjp0cnVlLCJjb25zdW1lclBob25lTnVtYmVyUmVxdWVzdGVkIjp0cnVlLCJyZXZpZXdBY3Rpb24iOiJjb250aW51ZSIsInRocmVlRHNQcmVmZXJlbmNlIjoiTk9ORSJ9fX19LCJjYXB0dXJlTWFuZGF0ZSI6eyJiaWxsaW5nVHlwZSI6IkZVTEwiLCJyZXF1ZXN0RW1haWwiOnRydWUsInJlcXVlc3RQaG9uZSI6dHJ1ZSwicmVxdWVzdFNoaXBwaW5nIjp0cnVlLCJzaGlwVG9Db3VudHJpZXMiOlsiVVMiLCJHQiJdLCJzaG93QWNjZXB0ZWROZXR3b3JrSWNvbnMiOnRydWV9LCJvcmRlckluZm9ybWF0aW9uIjp7ImFtb3VudERldGFpbHMiOnsidG90YWxBbW91bnQiOiIyMS4wMCIsImN1cnJlbmN5IjoiVVNEIn19LCJ0YXJnZXRPcmlnaW5zIjpbImh0dHBzOi8vcG9jLWxlbW9uLWZpdmUudmVyY2VsLmFwcCJdLCJpZnJhbWVzIjp7Im1jZSI6Ii9tY2UvaWZyYW1lLmh0bWwiLCJidXR0b25zIjoiL2J1dHRvbmxpc3QvaWZyYW1lLmh0bWwiLCJzcmMiOiIvc2VjdXJlLXJlbW90ZS1jb21tZXJjZS9zcmMuaHRtbCIsImN0cCI6Ii9jdHAvY3RwLmh0bWwiLCJnb29nbGVwYXkiOiIvZ29vZ2xlcGF5L2dvb2dsZXBheS5odG1sIiwiYXBwbGVwYXkiOiIvYXBwbGVwYXkvYXBwbGVwYXkuaHRtbCIsInBhemUiOiIvcGF6ZS9wYXplLmh0bWwiLCJjaGVjayI6Ii9jaGVjay9jaGVjay5odG1sIn0sImNsaWVudFZlcnNpb24iOiIwLjExIiwiY291bnRyeSI6IlVTIiwibG9jYWxlIjoiZW5fVVMiLCJhbGxvd2VkQ2FyZE5ldHdvcmtzIjpbIlZJU0EiLCJNQVNURVJDQVJEIiwiQU1FWCJdLCJjciI6InlmcERYaTY4Szk0eVJ2U1I2dGZHMjVrZ2txaUE1Mm8zXzVQdTA1dVhpSl9MRy1JOHF6VVRTeEZfcVp4Wnh6REpxTVkwaFN4UGhKSEtkU3JNc2thX2tfLTI0MkRQN2lyak0tSnJxam9XWlhyd3hLSU9SLWctelRTWDlpdGZsdyIsInNlcnZpY2VPcmlnaW4iOiJodHRwczovL2FwaXRlc3QuY3liZXJzb3VyY2UuY29tIiwiY2xpZW50TGlicmFyeSI6Imh0dHBzOi8vYXBpdGVzdC5jeWJlcnNvdXJjZS5jb20vdXAvdjEvYXNzZXRzLzAuMTEuMC9TZWN1cmVBY2NlcHRhbmNlLmpzIiwibG9nZ2luZ1BhdGgiOiIvdXAvdjEvbG9nLWV2ZW50cyIsImFzc2V0c1BhdGgiOiIvdXAvdjEvYXNzZXRzLzAuMTEuMCIsImNsaWVudExpYnJhcnlJbnRlZ3JpdHkiOiJzaGEyNTYtSm1SY1QxVFpPaThpWlRTMEZWSFdOanR2REorN1ZsdnNPTXRTZ0tMZUtLTVx1MDAzZCJ9LCJ0eXBlIjoiZ2RhLTAuOS4wIn1dLCJpc3MiOiJGbGV4IEFQSSIsImV4cCI6MTcyMzIxMTg2NywiaWF0IjoxNzIzMjEwOTY3LCJqdGkiOiI3dGl5eXFsZm54VXRJaXNZIn0.YdTeE_YmUMrHE_hXpVJGcWUczon5pLXOhUYpsgPImRCXk7KFpkEwuteLdlMuqZsuYIlxU7QxwkQmVmQqZW-nyj6OdnOc1h75FOOW1g2LTS2k6XJCDOOPtNdvL5Bnh9d7jMnTTiS7XUuCiWfOfULdNbt-fOtEijtVouD1isPIGxtWT3Q1FTB7R7moh-dsRB3hsNjBDa9GOVKwnL5o-g5ymjeekFkXMZS0ov-w1uHzwyN-flYz_GJ7eox1_vD1eEuyx_5UzGkIEsALqc1j5M71EUshvMkWgLNLV-sSl4crRm8c1FpXoRblFbZukCEwp2qIdug_cmKOGayOQcRSPsAnJw';
  const showArgs = {
    containers: {
      paymentSelection: "#buttonPaymentListContainer"
    }
  };

  Accept(captureContext)
      .then(accept => accept.unifiedPayments())
      .then(up => up.show(showArgs))
      .then(tt => {
        const transientToken = document.getElementById('transientToken');
        transientToken.value = tt;
        const authForm = document.getElementById('authForm');
        authForm.submit();
      })
      .catch(error => {
        console.error("Error en el flujo de Click to Pay:", error);
      });

  console.log('cargado script de VISA Click to Pay');
};

onMounted(() => {
  loadVisaClickToPay();
});
</script>
