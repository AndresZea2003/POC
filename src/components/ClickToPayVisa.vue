<template>
  <div>
    <div id="buttonPaymentListContainer"></div>
    <form id="authForm" action="/process-payment" method="POST">
      <input type="text" id="transientToken" name="transientToken" />
    </form>
  </div>
</template>

<script setup>
import { onMounted } from 'vue';

const loadVisaClickToPay = async () => {
  console.log('Cargando script de VISA Click to Pay...');
  console.log('ClientLibrary is: ', 'https://apitest.cybersource.com/up/v1/assets/0.22.0/SecureAcceptance.js');
  const script = document.createElement('script');
  script.src = 'https://apitest.cybersource.com/up/v1/assets/0.22.0/SecureAcceptance.js'; // clientLibrary obtenido de la captura de contexto
  script.async = true;
  script.onload = await onVisaClickToPayLoaded;
  script.onerror = function() {
    console.error('Error al cargar el script de VISA Click to Pay.');
  };
  document.head.appendChild(script);
};

const onVisaClickToPayLoaded = async () => {
  const captureContext = 'eyJraWQiOiJ6dSIsImFsZyI6IlJTMjU2In0.eyJmbHgiOnsicGF0aCI6Ii9mbGV4L3YyL3Rva2VucyIsImRhdGEiOiJ4RmFIUmdNUWVpejh4S2htVllZVk1oQUFFT2dYZWZPblZVbnpteVF0ekhOaG13TEdUT09uZGxteVhoaXltUXAyQW8vRUhJSHJhZVdiN3ArRjMrb0tBeDZaa3E5UktNNmNBdnVhekRnc2NjOEM2QUxjME8rcHBDNmE4Z01CYTNZQUtRMmRWdmY5MEZCcFRidElzU1pyYlFnc0pRXHUwMDNkXHUwMDNkIiwib3JpZ2luIjoiaHR0cHM6Ly90ZXN0ZmxleC5jeWJlcnNvdXJjZS5jb20iLCJqd2siOnsia3R5IjoiUlNBIiwiZSI6IkFRQUIiLCJ1c2UiOiJlbmMiLCJuIjoibUpyVkM4blc5YW81blR6MWZnMUNFek5fT0JCT3d5Zk9fdGZJZEtIWi1yZXZVa01ZenNNNndSWjh1czNud3BQZEJVbGlOMVE2OVg0UjNOMmFJU3ZoYUNUVHZZQ0xoZGt5eGtGSW5qTHI0ZjJxWVZpVWc5eWRnb2N6T2FBUGp1Q0hZRDZsYl9uSkVhRWhxOTZDLXNBcEtzUVZpNkhBUldzcU1ydy1mVjZaODlIRk1XcjQ4M2lnb0NmLTJEWFZEcmhNTjVBLVFPeEVaS0xIcmVzUGI4UGhkeV9GN0x1c0dQQUJEWDBuVG91b2gwcVp0Umx3OFg2UzFiVXk1X2VmU3pOUXh0dmpuSnFfX1hQSEFTb044bERUS01zTjl4MElYVGlvS0I1RTVPbDlHMlBuNndvRXNYUlpiM1lOa0FuV1h1czdDRVNJVWtHN0t2d09hOHNzRkNfdVdRIiwia2lkIjoiMDhCV2pOUDYyeHQxcEF5UnlOQ2cwcnVHSEE2NVlBVTAifX0sImN0eCI6W3siZGF0YSI6eyJhbGxvd2VkUGF5bWVudFR5cGVzIjpbeyJwYWdlIjoxLCJ0eXBlIjoiUEFORU5UUlkifSx7InBhZ2UiOjIsInR5cGUiOiJTUkNWSVNBIn0seyJwYWdlIjozLCJ0eXBlIjoiU1JDTUFTVEVSQ0FSRCJ9LHsicGFnZSI6NCwidHlwZSI6IlNSQ0FNRVgifV0sInBheW1lbnRDb25maWd1cmF0aW9ucyI6eyJTUkNWSVNBIjp7Im9yaWdpbiI6Imh0dHBzOi8vc2FuZGJveC1hc3NldHMuc2VjdXJlLmNoZWNrb3V0LnZpc2EuY29tIiwicGF0aCI6Ii9jaGVja291dC13aWRnZXQvcmVzb3VyY2VzL2pzL3NyYy1pLWFkYXB0ZXIvdmlzYVNkay5qcyIsInBhbkVuY3J5cHRpb25LZXkiOnsia3R5IjoiUlNBIiwiZSI6IkFRQUIiLCJ1c2UiOiJlbmMiLCJraWQiOiIzR1BXUFZJM0VTVzNHQ0pTMlk1RjEzYWVVWWxLVFZUaFhpUzJUS25ZS0V0TGwtUUVNIiwibiI6InNaUEl1c0RmN3lRbm5oQmtVOW11MTRWT08zQ3J1aTNiN3JBZjJLWWVvYlVSbVhBMTdiMUpYOWpnMENkLXZncG11eVRyeEJVU2MtNGIwLVVQZ1N3R0ZxUFdVcHgwOEV4cXJ3UERPdkZvakJvdTJ3bHlxOGJjeTBVcy1CZmVDelNFNWxNVmRTWFRYWFhjTnF1LXFiMjJqQ0NDSkFMcHhzQXJzYm9NT1hzTGVkaDNNNFhOUTVYR0F0UmY3Yi0tdVRZNURyOUtMWXlVdlpLQW5ZMDRNS0pQRU81NFlpSUZNNURUQWhOT21zMDg5amRNZHgtVVJJS0pqUFUyLVJwSEcxdThMQ0cwMjhSVElwUHNOYlJhbnVTNVRBWV96bHhEZ2IxaEtKMzZZYlpFTkhMZzlQWFRCaGRPTWxVOTBEVExsZmNiTFRhLUQ3RGdsakFhV0N1dnpMUGFHdyJ9LCJwYXJhbWV0ZXJzIjp7InNyY0luaXRpYXRvcklkIjoiSkZDWjhRVk9KQTc2TlhaNjhGWkQyMVJZSXhqM3lQWmRpVXhrZE51aWJCbHhnd2FQNCIsInNyY2lEcGFJZCI6ImEwMWVlMjBlLWE2ZTgtNDI3OC1iNGRmLTkxNTIyZjMyODg4NyIsInNyY2lUcmFuc2FjdGlvbklkIjoiNDFkOWE5ZDMtYzhmMy00NDY2LWI0YzYtMDY5NDk0NmFjN2JjIiwiZHBhVHJhbnNhY3Rpb25PcHRpb25zIjp7ImRwYUxvY2FsZSI6ImVzX0NPIiwicGF5bG9hZFR5cGVJbmRpY2F0b3IiOiJGVUxMIiwicmV2aWV3QWN0aW9uIjoiY29udGludWUiLCJkcGFBY2NlcHRlZEJpbGxpbmdDb3VudHJpZXMiOltdLCJkcGFBY2NlcHRlZFNoaXBwaW5nQ291bnRyaWVzIjpbIlVTIiwiR0IiXSwiZHBhQmlsbGluZ1ByZWZlcmVuY2UiOiJBTEwiLCJkcGFTaGlwcGluZ1ByZWZlcmVuY2UiOiJBTEwiLCJjb25zdW1lck5hbWVSZXF1ZXN0ZWQiOnRydWUsImNvbnN1bWVyRW1haWxBZGRyZXNzUmVxdWVzdGVkIjp0cnVlLCJjb25zdW1lclBob25lTnVtYmVyUmVxdWVzdGVkIjp0cnVlLCJ0cmFuc2FjdGlvbkFtb3VudCI6eyJ0cmFuc2FjdGlvbkFtb3VudCI6IjIxLjAwIiwidHJhbnNhY3Rpb25DdXJyZW5jeUNvZGUiOiJVU0QifSwicGF5bWVudE9wdGlvbnMiOnsiZHBhRHluYW1pY0RhdGFUdGxNaW51dGVzIjoxNSwiZHBhUGFuUmVxdWVzdGVkIjpmYWxzZSwiZHluYW1pY0RhdGFUeXBlIjoiVEFWViJ9fX19LCJTUkNNQVNURVJDQVJEIjp7Im9yaWdpbiI6Imh0dHBzOi8vc2FuZGJveC5zcmMubWFzdGVyY2FyZC5jb20iLCJwYXRoIjoiL3Nkay9zcmNzZGsubWFzdGVyY2FyZC5qcyIsInBhbkVuY3J5cHRpb25LZXkiOnsia3R5IjoiUlNBIiwiZSI6IkFRQUIiLCJ1c2UiOiJlbmMiLCJraWQiOiIyMDIzMDIwNzIyMzUyMS1zYW5kYm94LWZwYW4tZW5jcnlwdGlvbi1zcmMtbWFzdGVyY2FyZC1pbnQiLCJrZXlfb3BzIjpbImVuY3J5cHQiLCJ3cmFwS2V5Il0sImFsZyI6IlJTQS1PQUVQLTI1NiIsIm4iOiJ0MDZJOHNqbFMtcnJzN3VDYWdIOGV2b2V1bWFSb3ZLemlaU0k5UzJOOUlEUTl0VzJQYXBmUmE5TGMxS3ZlRUJEVnMyN1BraGtVNU95SGdQMGlFalR1S1Zwdmg1OVQ0bGEtbUJTSWxzN1VlY1VRTExhMFdrbWJ0TDdqTmRsdEE1ZnE3QWhjQXI1cWNhOTg4cXJMZDdJeXI5RTBDM1R4YlQ5dG8xaVFjcHo4b2NaT0RSWG9pZEZBbk9WTDVZR0ZtbHNyZURiSjRWaHNpMHBBZGNjUWNpbC15ZFNndXJLQi1ycUtwcGI5ZXBvbXU0UVVoMzM4MkN2OE5vYlltRjNvczhuR0dnR1AtY3lYbzBuc0tjUEFnZnJsUXpvczdxSHhVT3JGZTJ4X2xaMUcxQUUtWHJrcnhqQnlzOXE1M0dNUlNOQ1E4Yy1fbWNGOXBicTRIWUJzLXZENVEifSwicGFyYW1ldGVycyI6eyJzcmNpVHJhbnNhY3Rpb25JZCI6IjQxZDlhOWQzLWM4ZjMtNDQ2Ni1iNGM2LTA2OTQ5NDZhYzdiYyIsInNyY2lEcGFJZCI6ImEwMWVlMjBlLWE2ZTgtNDI3OC1iNGRmLTkxNTIyZjMyODg4NyIsInNyY0luaXRpYXRvcklkIjoiODQ0ZjdlM2QtMDdmMC00NGIxLWEyMzctZTY0MjQ0NGUwNTEyIiwiZHBhVHJhbnNhY3Rpb25PcHRpb25zIjp7InRyYW5zYWN0aW9uVHlwZSI6IlBVUkNIQVNFIiwiZHBhTG9jYWxlIjoiZXNfQ08iLCJkcGFBY2NlcHRlZFNoaXBwaW5nQ291bnRyaWVzIjpbIlVTIiwiR0IiXSwiY29uc3VtZXJFbWFpbEFkZHJlc3NSZXF1ZXN0ZWQiOnRydWUsImNvbnN1bWVyUGhvbmVOdW1iZXJSZXF1ZXN0ZWQiOnRydWUsInRyYW5zYWN0aW9uQW1vdW50Ijp7InRyYW5zYWN0aW9uQW1vdW50IjoiMjEuMDAiLCJ0cmFuc2FjdGlvbkN1cnJlbmN5Q29kZSI6IlVTRCJ9LCJkcGFBY2NlcHRlZEJpbGxpbmdDb3VudHJpZXMiOltdLCJkcGFCaWxsaW5nUHJlZmVyZW5jZSI6IkZVTEwiLCJkcGFTaGlwcGluZ1ByZWZlcmVuY2UiOiJGVUxMIiwiY29uc3VtZXJOYW1lUmVxdWVzdGVkIjp0cnVlLCJwYXlsb2FkVHlwZUluZGljYXRvciI6IkZVTEwiLCJwYXltZW50T3B0aW9ucyI6eyJkeW5hbWljRGF0YVR5cGUiOiJDQVJEX0FQUExJQ0FUSU9OX0NSWVBUT0dSQU1fU0hPUlRfRk9STSJ9fX19LCJTUkNBTUVYIjp7Im9yaWdpbiI6Imh0dHBzOi8vcXd3dy5hZXhwLXN0YXRpYy5jb20iLCJwYXRoIjoiL2FrYW1haS9yZW1vdGVjb21tZXJjZS9zY3JpcHRzL2FtZXhTREstMS4wLjAuanMiLCJwYW5FbmNyeXB0aW9uS2V5Ijp7Imt0eSI6IlJTQSIsImUiOiJBUUFCIiwidXNlIjoiZW5jIiwia2lkIjoic3JjLWFtZXgtY2FyZC1lbmMtMjAyNCIsImFsZyI6IlJTQS1PQUVQLTI1NiIsIm4iOiJtRWswYm1MQzJaUVctYTRLWDFuRFkzWmZQTEZySDh0blV5SWI1a1RLZ3phZWFnaW1hSDRYcVA0WncwNWlpNk12ZHZOMFQycHlTSlE0am9raFBDMklXZW1pVlBHOGZDUEJNSnh4ankyRXU5b3RiaXdHUkJDZ3h3Y3UtYWNqWWF1cFZQdERON2VuZ0hEZG5PZ2FybG9HclBVTTZJRUVaV192RUI5Y1NyTV9CYThTY0M4UmFmZ05TWTgxaXhheFBBOGNPaEFBdnJMUTdLaEU1UXhTeklNZnJ6YjFMQllHTDRZUEJ1bmZOQTJ3M2Z2THdmQmwyXy1SRlJDVW1QRXYxTnVYcXhvMVJOMDhqMnVuOGVpY0d2bnQwZ3QtMjFuR3JiYzZ4cHA3cFpZMm9qLWhjMFpVbE55RV9rSnBMUzVPVVo4R2VPWnA0cVZSeGhrSVBHeEVlRi1RV2lTZzh1V2sxeDZuY3Rock1VSllWMUhQdTh0SGtKRG04QWEtRHNoUE5laXhEal9WRlZFUzhWLXlJSVJ3Zy1VMjgyV1BiMFQydEtSWGRuamxOdmNsQnNJXzRWd2c1Y1dFaFNrU3N6VUF5MVBDU0Zua1o1SUVPcmhnXzBUcGU3YWlPOHc1c1J3TmhablJwSnlJc1B0LWxNQ283enI4NUIydnhjb1BmZlNTcDNGWiJ9LCJwYXJhbWV0ZXJzIjp7InNyY2lUcmFuc2FjdGlvbklkIjoiNDFkOWE5ZDMtYzhmMy00NDY2LWI0YzYtMDY5NDk0NmFjN2JjIiwic3JjSW5pdGlhdG9ySWQiOiI4ZWMyYzg4OC02NGNjLTRlZmMtOTE3NS1iMzM3NDUyYjI4YzgiLCJkcGFEYXRhIjp7ImRwYU5hbWUiOiJHRVRORVQgQ0hJTEUgUy5BLiIsImRwYUxvZ29VcmkiOiJodHRwczovL3d3dy5nZXRuZXQuY2wvIiwiZHBhUHJlc2VudGF0aW9uTmFtZSI6IkdFVE5FVCBDSElMRSBTLkEuIiwiZHBhVXJpIjoiaHR0cHM6Ly93d3cuZ2V0bmV0LmNsLyJ9LCJkcGFUcmFuc2FjdGlvbk9wdGlvbnMiOnsiZHBhTG9jYWxlIjoiZXNfQ08iLCJkcGFBY2NlcHRlZEJpbGxpbmdDb3VudHJpZXMiOltdLCJkcGFBY2NlcHRlZFNoaXBwaW5nQ291bnRyaWVzIjpbIlVTIiwiR0IiXSwiZHBhQmlsbGluZ1ByZWZlcmVuY2UiOiJBTEwiLCJkcGFTaGlwcGluZ1ByZWZlcmVuY2UiOiJBTEwiLCJjb25zdW1lck5hbWVSZXF1ZXN0ZWQiOnRydWUsImNvbnN1bWVyRW1haWxBZGRyZXNzUmVxdWVzdGVkIjp0cnVlLCJjb25zdW1lclBob25lTnVtYmVyUmVxdWVzdGVkIjp0cnVlLCJyZXZpZXdBY3Rpb24iOiJjb250aW51ZSIsInRocmVlRHNQcmVmZXJlbmNlIjoiTk9ORSJ9fX19LCJjYXB0dXJlTWFuZGF0ZSI6eyJiaWxsaW5nVHlwZSI6IkZVTEwiLCJyZXF1ZXN0RW1haWwiOnRydWUsInJlcXVlc3RQaG9uZSI6dHJ1ZSwicmVxdWVzdFNoaXBwaW5nIjp0cnVlLCJzaGlwVG9Db3VudHJpZXMiOlsiVVMiLCJHQiJdLCJzaG93QWNjZXB0ZWROZXR3b3JrSWNvbnMiOnRydWV9LCJvcmRlckluZm9ybWF0aW9uIjp7ImFtb3VudERldGFpbHMiOnsidG90YWxBbW91bnQiOiIyMS4wMCIsImN1cnJlbmN5IjoiVVNEIn19LCJ0YXJnZXRPcmlnaW5zIjpbImh0dHBzOi8vcG9jLWxlbW9uLWZpdmUudmVyY2VsLmFwcCJdLCJpZnJhbWVzIjp7Im1jZSI6Ii9tY2UvbWNlLmh0bWwiLCJidXR0b25zIjoiL2J1dHRvbmxpc3QvYnV0dG9ubGlzdC5odG1sIiwic3JjIjoiL3NlY3VyZS1yZW1vdGUtY29tbWVyY2Uvc3JjLmh0bWwiLCJjdHAiOiIvY3RwL2N0cC5odG1sIiwiZ29vZ2xlcGF5IjoiL2dvb2dsZXBheS9nb29nbGVwYXkuaHRtbCIsImFwcGxlcGF5IjoiL2FwcGxlcGF5L2FwcGxlcGF5Lmh0bWwiLCJwYXplIjoiL3BhemUvcGF6ZS5odG1sIiwiY2hlY2siOiIvY2hlY2svY2hlY2suaHRtbCJ9LCJjbGllbnRWZXJzaW9uIjoiMC4yMiIsImNvdW50cnkiOiJDTyIsImxvY2FsZSI6ImVzX0NPIiwiYWxsb3dlZENhcmROZXR3b3JrcyI6WyJWSVNBIiwiTUFTVEVSQ0FSRCIsIkFNRVgiXSwiY3IiOiIweVBvcDdCNVNnaGVTMFhVa3EzcWNnWjRnSU9vQnJKQmpiOTdicTZDbUc5cjdHSV9QYW9JRW5TeHhuT3QtZ2NuSlRPSGRjbGFRWEZsSWZhdVJiZHY3QzNDTnc5Rkh5aXNTNmp0QUJGLUFXNkRWMXluMEgzYzJuSHJwSVo3SHciLCJzZXJ2aWNlT3JpZ2luIjoiaHR0cHM6Ly9hcGl0ZXN0LmN5YmVyc291cmNlLmNvbSIsImNsaWVudExpYnJhcnkiOiJodHRwczovL2FwaXRlc3QuY3liZXJzb3VyY2UuY29tL3VwL3YxL2Fzc2V0cy8wLjIyLjAvU2VjdXJlQWNjZXB0YW5jZS5qcyIsImxvZ2dpbmdQYXRoIjoiL3VwL3YxL2xvZy1ldmVudHMiLCJhc3NldHNQYXRoIjoiL3VwL3YxL2Fzc2V0cy8wLjIyLjAiLCJjbGllbnRMaWJyYXJ5SW50ZWdyaXR5Ijoic2hhMjU2LWdoT1FsTmFmUUNSTCtuUUU3U3VaWXNXdWxMdDZJYm43TVRFQkgvVXQ2NlFcdTAwM2QifSwidHlwZSI6ImdkYS0wLjkuMCJ9XSwiaXNzIjoiRmxleCBBUEkiLCJleHAiOjE3MjMyMzcxODEsImlhdCI6MTcyMzIzNjI4MSwianRpIjoibkxncUphY0JxeXgydHM1diJ9.aLX-zgu4M_ISF1pq9Hmv2jRFaYMVIZCYb5iciHQLAP_ajEghpEmLl_MBNgH1NzeLEpIlE2dKI4kDzXpXnLJtsV72PF7aPekHsL5oRng1CtQ-ese_Au0bQMMzrzpGwyuW0glbhy7JPBd2iKEFZZI2W34uYFlPm8q2QlJCKxZDtmflCihhKoiNpi9gULCd14dDOMzNiLNjE9VAYqsNC5l9o-LKhV5LCofD33jO2Yrtbd8iI2yfWX81XTFctyP6FeNPQGzwZ8PtTmCBzSq6bEYFakO4gr3rYFc4DFSJ6P0wajLLwn0jY7_8PmT5ZRgBfGb7XYT-RkOZx57mB9U4ymh9HQ';
  const showArgs = {
    containers: {
      paymentSelection: "#buttonPaymentListContainer"
    }
  };

  Accept(captureContext)
      .then(accept => accept.unifiedPayments())
      .then(up => up.show(showArgs))
      .then(tt => {
        const transientToken = document.getElementById('transientToken');
        transientToken.value = tt;
        const authForm = document.getElementById('authForm');
        authForm.submit();

        console.log('tt:', tt);
        console.log('GetElement Transient Token:', document.getElementById('transientToken').value);
      })
      .catch(error => {
        console.error("Error en el flujo de Click to Pay:", error);
      });

  console.log('cargado script de VISA Click to Pay');
};

onMounted(() => {
  loadVisaClickToPay();
});
</script>
