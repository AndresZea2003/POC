<template>
  <div>
    <div id="buttonPaymentListContainer"></div>
    <textarea id="transientToken" name="transientToken" rows="25" cols="50"></textarea>
  </div>
</template>

<script setup>
import { onMounted } from 'vue';

const loadVisaClickToPay = async () => {
  console.log('Cargando script de VISA Click to Pay...');
  const script = document.createElement('script');
  script.src = 'https://apitest.cybersource.com/up/v1/assets/0.22.0/SecureAcceptance.js'; // clientLibrary obtenido de la captura de contexto
  script.async = true;
  script.onload = await onVisaClickToPayLoaded;
  script.onerror = function() {
    console.error('Error al cargar el script de VISA Click to Pay.');
  };
  document.head.appendChild(script);
};

const onVisaClickToPayLoaded = async () => {
  const captureContext = 'eyJraWQiOiJ6dSIsImFsZyI6IlJTMjU2In0.eyJmbHgiOnsicGF0aCI6Ii9mbGV4L3YyL3Rva2VucyIsImRhdGEiOiJobldXdVhWK0hkYmdwdzAxT1ZBQjhSQUFFTFZ6dFVtbVFmWU95ZGZsVWhrTGU3RFBhUFl6U3hCSjlNZDYxREZRZSs3aVpNZEJ2ekppQXpHdkFjOStNcmp1RGwrakdrR3lFYWpVSG1rck1Jc2d3YXJOaXN1aGt4Q1MzMHZLbUpuRXBTb3ZzMEZuajkwcWJ0NEI4cUgwdzNlVnVBXHUwMDNkXHUwMDNkIiwib3JpZ2luIjoiaHR0cHM6Ly90ZXN0ZmxleC5jeWJlcnNvdXJjZS5jb20iLCJ0cmFuc2llbnRUb2tlbk9wZXJhdGlvbnMiOlt7InN1YiI6InRlc3RnZXRuZXRjbF9zYW5kYm94MDAxIiwiYXVkIjoiZ2V0bmV0Y2xfc2FuZGJveCIsImtpZCI6ImUwNDQ5YWU4LTUxZDgtNDQ0MC1iN2IzLWJiODQxYWYzNjIwMiIsInR5cGUiOiJTVE9SRSJ9XSwiandrIjp7Imt0eSI6IlJTQSIsImUiOiJBUUFCIiwidXNlIjoiZW5jIiwibiI6InByX3dBTE4tcFp4MkJhUDlDVXJMaEV0Sno4YWxqR3dfOVdHOE5nd18wcmVseUg1MFRsLUpjMGFBelU4cDVVZ2JLU3B2eFhuUWlHd1FVU25wUzVadVhfLW1GY2x0SW1Ja20tdXZ4YVlUbmxKQXVMYkl2aGpqamRWZG9NVWc1SHZIWS0xNTgyaEdUOEoyV3JZdzctSXZvMTg2YmotNV9OUHBIRDI5U1NkQVdBQldna3ZKa1RQbzlZQ2NBLTJRay1vLTRieURDTnlfYjBMSHNZTC1CRmRoblplckQtdWNKM1VvV3BPLTkwQnoyQWRzM1pEdXpITnYzd0gxSi1WZm0xemJIYmZLZHAyWkRFQ05iM25DYk5hTl95S0xlelNUOWlOaEI1UFR3ODdTQ0FpeV9ZQlprRVZGaXpfMWhJVTRCQks2WnFNSUdGb25fTktlYV9IbWdtSk9tUSIsImtpZCI6IjA4UEIyWG9MQlllaEg5d3dyRVM4djNtT250a3NPNDNYIn19LCJjdHgiOlt7ImRhdGEiOnsiYWxsb3dlZFBheW1lbnRUeXBlcyI6W3sicGFnZSI6MSwidHlwZSI6IkNMSUNLVE9QQVkifSx7InBhZ2UiOjIsInR5cGUiOiJTUkNWSVNBIn0seyJwYWdlIjozLCJ0eXBlIjoiU1JDTUFTVEVSQ0FSRCJ9LHsicGFnZSI6NCwidHlwZSI6IlNSQ0FNRVgifSx7InBhZ2UiOjUsInR5cGUiOiJQQU5FTlRSWSJ9XSwicGF5bWVudENvbmZpZ3VyYXRpb25zIjp7IlNSQ1ZJU0EiOnsib3JpZ2luIjoiaHR0cHM6Ly9zYW5kYm94LWFzc2V0cy5zZWN1cmUuY2hlY2tvdXQudmlzYS5jb20iLCJwYXRoIjoiL2NoZWNrb3V0LXdpZGdldC9yZXNvdXJjZXMvanMvc3JjLWktYWRhcHRlci92aXNhU2RrLmpzP3YyIiwicGFuRW5jcnlwdGlvbktleSI6eyJrdHkiOiJSU0EiLCJlIjoiQVFBQiIsInVzZSI6ImVuYyIsImtpZCI6IjNHUFdQVkkzRVNXM0dDSlMyWTVGMTNhZVVZbEtUVlRoWGlTMlRLbllLRXRMbC1RRU0iLCJuIjoic1pQSXVzRGY3eVFubmhCa1U5bXUxNFZPTzNDcnVpM2I3ckFmMktZZW9iVVJtWEExN2IxSlg5amcwQ2QtdmdwbXV5VHJ4QlVTYy00YjAtVVBnU3dHRnFQV1VweDA4RXhxcndQRE92Rm9qQm91MndseXE4YmN5MFVzLUJmZUN6U0U1bE1WZFNYVFhYWGNOcXUtcWIyMmpDQ0NKQUxweHNBcnNib01PWHNMZWRoM000WE5RNVhHQXRSZjdiLS11VFk1RHI5S0xZeVV2WktBblkwNE1LSlBFTzU0WWlJRk01RFRBaE5PbXMwODlqZE1keC1VUklLSmpQVTItUnBIRzF1OExDRzAyOFJUSXBQc05iUmFudVM1VEFZX3pseERnYjFoS0ozNlliWkVOSExnOVBYVEJoZE9NbFU5MERUTGxmY2JMVGEtRDdEZ2xqQWFXQ3V2ekxQYUd3In0sInBhcmFtZXRlcnMiOnsic3JjSW5pdGlhdG9ySWQiOiJKRkNaOFFWT0pBNzZOWFo2OEZaRDIxUllJeGozeVBaZGlVeGtkTnVpYkJseGd3YVA0Iiwic3JjaURwYUlkIjoiYTAxZWUyMGUtYTZlOC00Mjc4LWI0ZGYtOTE1MjJmMzI4ODg3Iiwic3JjaVRyYW5zYWN0aW9uSWQiOiJmYWUyNjQ5NS04MzVlLTRhZTYtYmUyNy0wN2ZjNmRmNjgzNDYiLCJkcGFUcmFuc2FjdGlvbk9wdGlvbnMiOnsiZHBhTG9jYWxlIjoiZXNfQ08iLCJwYXlsb2FkVHlwZUluZGljYXRvciI6IkZVTEwiLCJyZXZpZXdBY3Rpb24iOiJjb250aW51ZSIsImRwYUFjY2VwdGVkQmlsbGluZ0NvdW50cmllcyI6W10sImRwYUFjY2VwdGVkU2hpcHBpbmdDb3VudHJpZXMiOlsiVVMiLCJHQiJdLCJkcGFCaWxsaW5nUHJlZmVyZW5jZSI6IkFMTCIsImRwYVNoaXBwaW5nUHJlZmVyZW5jZSI6Ik5PTkUiLCJjb25zdW1lck5hbWVSZXF1ZXN0ZWQiOnRydWUsImNvbnN1bWVyRW1haWxBZGRyZXNzUmVxdWVzdGVkIjpmYWxzZSwiY29uc3VtZXJQaG9uZU51bWJlclJlcXVlc3RlZCI6ZmFsc2UsIm1lcmNoYW50Q291bnRyeUNvZGUiOiJDTyIsImN1c3RvbUlucHV0RGF0YSI6eyJjaGVja291dE9yY2hlc3RyYXRvciI6Im1lcmNoYW50In0sInRyYW5zYWN0aW9uQW1vdW50Ijp7InRyYW5zYWN0aW9uQW1vdW50IjoiMjAwMDAiLCJ0cmFuc2FjdGlvbkN1cnJlbmN5Q29kZSI6IkNPUCJ9LCJwYXltZW50T3B0aW9ucyI6eyJkcGFEeW5hbWljRGF0YVR0bE1pbnV0ZXMiOjE1LCJkcGFQYW5SZXF1ZXN0ZWQiOmZhbHNlLCJkeW5hbWljRGF0YVR5cGUiOiJDQVJEX0FQUExJQ0FUSU9OX0NSWVBUT0dSQU1fTE9OR19GT1JNIn19fX0sIlNSQ01BU1RFUkNBUkQiOnsib3JpZ2luIjoiaHR0cHM6Ly9zYW5kYm94LnNyYy5tYXN0ZXJjYXJkLmNvbSIsInBhdGgiOiIvc2RrL3NyY3Nkay5tYXN0ZXJjYXJkLmpzIiwicGFuRW5jcnlwdGlvbktleSI6eyJrdHkiOiJSU0EiLCJlIjoiQVFBQiIsInVzZSI6ImVuYyIsImtpZCI6IjIwMjMwMjA3MjIzNTIxLXNhbmRib3gtZnBhbi1lbmNyeXB0aW9uLXNyYy1tYXN0ZXJjYXJkLWludCIsImtleV9vcHMiOlsiZW5jcnlwdCIsIndyYXBLZXkiXSwiYWxnIjoiUlNBLU9BRVAtMjU2IiwibiI6InQwNkk4c2psUy1ycnM3dUNhZ0g4ZXZvZXVtYVJvdkt6aVpTSTlTMk45SURROXRXMlBhcGZSYTlMYzFLdmVFQkRWczI3UGtoa1U1T3lIZ1AwaUVqVHVLVnB2aDU5VDRsYS1tQlNJbHM3VWVjVVFMTGEwV2ttYnRMN2pOZGx0QTVmcTdBaGNBcjVxY2E5ODhxckxkN0l5cjlFMEMzVHhiVDl0bzFpUWNwejhvY1pPRFJYb2lkRkFuT1ZMNVlHRm1sc3JlRGJKNFZoc2kwcEFkY2NRY2lsLXlkU2d1cktCLXJxS3BwYjllcG9tdTRRVWgzMzgyQ3Y4Tm9iWW1GM29zOG5HR2dHUC1jeVhvMG5zS2NQQWdmcmxRem9zN3FIeFVPckZlMnhfbFoxRzFBRS1YcmtyeGpCeXM5cTUzR01SU05DUThjLV9tY0Y5cGJxNEhZQnMtdkQ1USJ9LCJwYXJhbWV0ZXJzIjp7InNyY2lUcmFuc2FjdGlvbklkIjoiZmFlMjY0OTUtODM1ZS00YWU2LWJlMjctMDdmYzZkZjY4MzQ2Iiwic3JjaURwYUlkIjoiYTAxZWUyMGUtYTZlOC00Mjc4LWI0ZGYtOTE1MjJmMzI4ODg3Iiwic3JjSW5pdGlhdG9ySWQiOiI4NDRmN2UzZC0wN2YwLTQ0YjEtYTIzNy1lNjQyNDQ0ZTA1MTIiLCJkcGFUcmFuc2FjdGlvbk9wdGlvbnMiOnsidHJhbnNhY3Rpb25UeXBlIjoiUFVSQ0hBU0UiLCJkcGFMb2NhbGUiOiJlc19DTyIsImRwYUFjY2VwdGVkU2hpcHBpbmdDb3VudHJpZXMiOlsiVVMiLCJHQiJdLCJjb25zdW1lckVtYWlsQWRkcmVzc1JlcXVlc3RlZCI6ZmFsc2UsImNvbnN1bWVyUGhvbmVOdW1iZXJSZXF1ZXN0ZWQiOmZhbHNlLCJ0cmFuc2FjdGlvbkFtb3VudCI6eyJ0cmFuc2FjdGlvbkFtb3VudCI6IjIwMDAwIiwidHJhbnNhY3Rpb25DdXJyZW5jeUNvZGUiOiJDT1AifSwiZHBhQWNjZXB0ZWRCaWxsaW5nQ291bnRyaWVzIjpbXSwiZHBhQmlsbGluZ1ByZWZlcmVuY2UiOiJGVUxMIiwiZHBhU2hpcHBpbmdQcmVmZXJlbmNlIjoiTk9ORSIsImNvbnN1bWVyTmFtZVJlcXVlc3RlZCI6dHJ1ZSwicGF5bG9hZFR5cGVJbmRpY2F0b3IiOiJGVUxMIiwicGF5bWVudE9wdGlvbnMiOnsiZHluYW1pY0RhdGFUeXBlIjoiQ0FSRF9BUFBMSUNBVElPTl9DUllQVE9HUkFNX1NIT1JUX0ZPUk0ifX19fSwiU1JDQU1FWCI6eyJvcmlnaW4iOiJodHRwczovL3F3d3cuYWV4cC1zdGF0aWMuY29tIiwicGF0aCI6Ii9ha2FtYWkvcmVtb3RlY29tbWVyY2Uvc2NyaXB0cy9hbWV4U0RLLTEuMC4wLmpzIiwicGFuRW5jcnlwdGlvbktleSI6eyJrdHkiOiJSU0EiLCJlIjoiQVFBQiIsInVzZSI6ImVuYyIsImtpZCI6InNyYy1hbWV4LWNhcmQtZW5jLTIwMjUiLCJhbGciOiJSU0EtT0FFUC0yNTYiLCJuIjoidk1LQjM2SXVrem93akJJVXYtMUNSTE5yMk9ydmhfU0JtT1hXazBRVUl1bTJiY3pwQUVsUEVXdnR2MlE3bjlLMWFOOHZ6WWgzTVl5R25INjhhdjRDUnhvTng4UFlWSU9lZk4zSHJVTU1SQ3M3NFBzY2RwTTRNTlVocGZIX1NWYWx2M0tZRlJEYVp4Zm9jZTFERFFVVGRyNHJYUnI5b1c0aVFJVmRfZkpOQmlMSVU3Zm1TSERkazdsVnFRZ2hhUExKWFRDNnh6UXpramEzQVB2bmZrZVhGVXZpVVg2dndxbjJiTENqV2dIVmNkMW5yS01OalMxTjJpd2swUXdaZW5kbHlyVEhwZTU1d2FIOGx4Z2xpUEVOVzVIemdkNTBRR3pFTWlqcUJ3TVVGd0VqVWJ1bWtmd1I0dlBrLUc1QXZTc0JUbklFYldYTzVaa2p5aW1BZi0zT0tiNGhiREVRLXh6czhsakFQTVFPSnkwQjl1cl84RV9UOFdEdEc4OHFxVmRjbHBGVm1IRHJxYmpzY1RQY2k0ZGRBZHFWLXBwd0JzNzA0MmNsM2l0RVpvTnBKOXlxTzVPS3NjbWNLalMxSkhsbGVpWUMyNDh3NXEzUFhYcl9QM1NPaml0V2xpLW9PbE90Q1lIXzJxMEVzNlJud2R6Q0hPVThYWk93a0l2Y2hRQUQifSwicGFyYW1ldGVycyI6eyJzcmNpVHJhbnNhY3Rpb25JZCI6ImZhZTI2NDk1LTgzNWUtNGFlNi1iZTI3LTA3ZmM2ZGY2ODM0NiIsInNyY0luaXRpYXRvcklkIjoiOGVjMmM4ODgtNjRjYy00ZWZjLTkxNzUtYjMzNzQ1MmIyOGM4IiwiZHBhRGF0YSI6eyJkcGFOYW1lIjoiR0VUTkVUIENISUxFIFMuQS4iLCJkcGFMb2dvVXJpIjoiaHR0cHM6Ly93d3cuZ2V0bmV0LmNsLyIsImRwYVByZXNlbnRhdGlvbk5hbWUiOiJHRVRORVQgQ0hJTEUgUy5BLiIsImRwYVVyaSI6Imh0dHBzOi8vd3d3LmdldG5ldC5jbC8ifSwiZHBhVHJhbnNhY3Rpb25PcHRpb25zIjp7ImRwYUxvY2FsZSI6ImVzX0NPIiwiZHBhQWNjZXB0ZWRCaWxsaW5nQ291bnRyaWVzIjpbXSwiZHBhQWNjZXB0ZWRTaGlwcGluZ0NvdW50cmllcyI6WyJVUyIsIkdCIl0sImRwYUJpbGxpbmdQcmVmZXJlbmNlIjoiQUxMIiwiZHBhU2hpcHBpbmdQcmVmZXJlbmNlIjoiTk9ORSIsImNvbnN1bWVyTmFtZVJlcXVlc3RlZCI6dHJ1ZSwiY29uc3VtZXJFbWFpbEFkZHJlc3NSZXF1ZXN0ZWQiOmZhbHNlLCJjb25zdW1lclBob25lTnVtYmVyUmVxdWVzdGVkIjpmYWxzZSwicmV2aWV3QWN0aW9uIjoiY29udGludWUiLCJ0aHJlZURzUHJlZmVyZW5jZSI6Ik5PTkUifX19fSwiY2FwdHVyZU1hbmRhdGUiOnsiYmlsbGluZ1R5cGUiOiJGVUxMIiwicmVxdWVzdEVtYWlsIjpmYWxzZSwicmVxdWVzdFBob25lIjpmYWxzZSwicmVxdWVzdFNoaXBwaW5nIjpmYWxzZSwic2hpcFRvQ291bnRyaWVzIjpbIlVTIiwiR0IiXSwic2hvd0FjY2VwdGVkTmV0d29ya0ljb25zIjp0cnVlfSwib3JkZXJJbmZvcm1hdGlvbiI6eyJhbW91bnREZXRhaWxzIjp7InRvdGFsQW1vdW50IjoiMjAwMDAiLCJjdXJyZW5jeSI6IkNPUCJ9fSwidGFyZ2V0T3JpZ2lucyI6WyJodHRwczovL3BvYy1sZW1vbi1maXZlLnZlcmNlbC5hcHAiXSwiaWZyYW1lcyI6eyJtY2UiOiIvbWNlL21jZS5odG1sIiwiYnV0dG9ucyI6Ii9idXR0b25saXN0L2J1dHRvbmxpc3QuaHRtbCIsInNyYyI6Ii9zZWN1cmUtcmVtb3RlLWNvbW1lcmNlL3NyYy5odG1sIiwiY3RwIjoiL2N0cC9jdHAuaHRtbCIsImdvb2dsZXBheSI6Ii9nb29nbGVwYXkvZ29vZ2xlcGF5Lmh0bWwiLCJhcHBsZXBheSI6Ii9hcHBsZXBheS9hcHBsZXBheS5odG1sIiwicGF6ZSI6Ii9wYXplL3BhemUuaHRtbCIsImNoZWNrIjoiL2NoZWNrL2NoZWNrLmh0bWwifSwiY2xpZW50VmVyc2lvbiI6IjAuMjIiLCJjb3VudHJ5IjoiQ08iLCJsb2NhbGUiOiJlc19DTyIsImFsbG93ZWRDYXJkTmV0d29ya3MiOlsiVklTQSIsIk1BU1RFUkNBUkQiLCJBTUVYIl0sImNyIjoiTmp6MURTX3EtanVnZkRXaDVSU2w1R3hlTlF1aVA0bFRwR21aMGkyUWhQRm5lVWFGUVNSRE9rZDU1WHAwbjM3c2FSandOX0RpNzgteHJRZzg2TmpPVUM0c0ZVMkJ4UlBPZGthZnMxN0RUZkxTdVZtTS05UlhmNUJ1Iiwic2VydmljZU9yaWdpbiI6Imh0dHBzOi8vYXBpdGVzdC5jeWJlcnNvdXJjZS5jb20iLCJjbGllbnRMaWJyYXJ5IjoiaHR0cHM6Ly9hcGl0ZXN0LmN5YmVyc291cmNlLmNvbS91Yy92MS9hc3NldHMvMC4yMi40L1NlY3VyZUFjY2VwdGFuY2UuanMiLCJsb2dnaW5nUGF0aCI6Ii91Yy92MS9sb2ctZXZlbnRzIiwiYXNzZXRzUGF0aCI6Ii91Yy92MS9hc3NldHMvMC4yMi40IiwiY2xpZW50TGlicmFyeUludGVncml0eSI6InNoYTI1Ni10M2tXcXJxS3BXQWJINUNDVDhkNy94TG1keEw4aG1zSlF3R0VLdWsxckRvXHUwMDNkIn0sInR5cGUiOiJnZGEtMC45LjAifV0sImlzcyI6IkZsZXggQVBJIiwiZXhwIjoxNzMyNzIyMzQ1LCJpYXQiOjE3MzI3MjE0NDUsImp0aSI6IjA3bVoxTzluYUEyWXJBSWoifQ.HL8QxnZI_M7rnjtf8M3f8t3UpksyjVC4k9ZS7NWOkf2DO1VpDaK-eXo1owc6lhbuMJXtXGfX2_ewf7LlMEflLqObLmz-IEE1IjWTXeEarnxxG2W_i9gn8uA9KPJvxcP41bjuWL4-ijFnxIaEbH2vcU7KNyj70KGwrz7buS6gaDDjzLEvfiTuJcC7MQm5ot_3434Vy78MoY_CaKMiuHufZThRmszzrEEHtsQU2FHAeMeNBGfeHrCg7xVFWMS5ZpreWMvovEP1Q8YgujFFI-RrnhFCfgapHXsXrvwudOHJ3TfcnqKvwyfAgS5xsSTN_gerp87wAL_H_xjmb7cg1vjCfw';
  const showArgs = {
    containers: {
      paymentSelection: "#buttonPaymentListContainer"
    }
  };

  Accept(captureContext)
      .then(accept => accept.unifiedPayments())
      .then(up => up.show(showArgs))
      .then(tt => {
        const transientToken = document.getElementById('transientToken');
        transientToken.value = tt;

        console.log('tt:', tt);
      })
      .catch(error => {
        console.error("Error en el flujo de Click to Pay:", error);
      });

  console.log('cargado script de VISA Click to Pay');
};

onMounted(() => {
  console.log('Actualizado el 27 de nov a las 10:32 am')
  loadVisaClickToPay();
});
</script>
