<template>
  <div class="flex flex-col items-center justify-center h-3/4 my-5 bg-gray-100 p-6 rounded-lg shadow-lg">
    <div
      class="w-full max-w-md p-4 border border-gray-300 rounded-lg bg-white shadow-md"
      id="buttonPaymentListContainer"
    ></div>
    <textarea
      class="mt-6 w-full max-w-md h-80 p-4 border border-gray-300 rounded-lg bg-white shadow-md resize-none"
      id="transientToken"
      name="transientToken"
      placeholder="Token transitorio generado aparecerá aquí..."
    ></textarea>
  </div>
</template>

<script setup>
import { onMounted } from 'vue';

const loadVisaClickToPay = async () => {
  console.log('Cargando script de VISA Click to Pay...');
  const script = document.createElement('script');
  script.src = 'https://apitest.cybersource.com/up/v1/assets/0.22.6/SecureAcceptance.js'; // clientLibrary obtenido de la captura de contexto
  script.async = true;
  script.onload = await onVisaClickToPayLoaded;
  script.onerror = function() {
    console.error('Error al cargar el script de VISA Click to Pay.');
  };
  document.head.appendChild(script);
};

const onVisaClickToPayLoaded = async () => {
  const captureContext = 'eyJraWQiOiJ6dSIsImFsZyI6IlJTMjU2In0.eyJmbHgiOnsicGF0aCI6Ii9mbGV4L3YyL3Rva2VucyIsImRhdGEiOiI2K2JzWFU3WFZnQkZNWG1iRzVMZWRCQUFFR1FUaUYzUy96Q1p4cDZSUXc5V1MzQi8wNC8vNXVkcU9WNGVlbjR3dkhWVTBMSERvL3YvSkNrY2JwQnhaMUQ1MnIrK2RKaDlKclFvMkx4RUl3UTBPQ2lWV2NsS1NSelYxQ0tJVERCUCsyZkkvdnZKN0RNZzVPK3gxNXBwMkRKOG51MzlhemhCUVdnUzFNT3NOWG1xK0JlNE9rMDNmOE81QkhIOTVoaFpJTnNNY2RCTjIvQmlYN2FZS2V6bDVHZEd5QVx1MDAzZFx1MDAzZCIsIm9yaWdpbiI6Imh0dHBzOi8vdGVzdGZsZXguY3liZXJzb3VyY2UuY29tIiwidHJhbnNpZW50VG9rZW5PcGVyYXRpb25zIjpbeyJzdWIiOiJ0ZXN0Z2V0bmV0Y2xfc2FuZGJveDAwMSIsImF1ZCI6ImdldG5ldGNsX3NhbmRib3giLCJraWQiOiJlMDQ0OWFlOC01MWQ4LTQ0NDAtYjdiMy1iYjg0MWFmMzYyMDIiLCJ0eXBlIjoiU1RPUkUifV0sImp3ayI6eyJrdHkiOiJSU0EiLCJlIjoiQVFBQiIsInVzZSI6ImVuYyIsIm4iOiIzODZ2M29fem40RTlYX0RiQUhfMmtCNG5iSU9uUTdYOEFFZmhWdHdIaEdEV1ZTeHMyS2N5Q0lxX0FhRjh6MmpMTVVnQUVJSWZVYm9XbWZMU0FuRUJySTRjRkRJVUFfaXNpSzFRVlBkeXlVMUZyQllmQTdxNlg1ZFBVRDZoYzJ1N3oxWkVsUlpQakdzU05US01OcEZYSldxQVo4bm9aUGc4bDhWV3FPaFRNa0ZncG45ODFJOFJNSnh0SnNJdlA1S1REVGJmQ2FiT1E0enhJb0xsSXl3Si1JclZGS3NueFhPbmdySWt3ZnlRRkt3Q1lkMEg1ckRxVXFFeW41QXVlcS1qa2xJVDdpdVhLM09TS0c4R1JMMndWNnNQZXpUZElZczRjQm9Kb0xlczV2QWE0cTFNWVoxZ21ySUVuUU1Lam1ZSUpxNkp6Q0Zib1RJUVA0MVNERE8xbFEiLCJraWQiOiIwN3dETFRyb2d0ZHpabnpNVkFGY0phdENhSUdoT2lzeiJ9fSwiY3R4IjpbeyJkYXRhIjp7ImFsbG93ZWRQYXltZW50VHlwZXMiOlt7InBhZ2UiOjEsInR5cGUiOiJDTElDS1RPUEFZIn0seyJwYWdlIjoyLCJ0eXBlIjoiU1JDVklTQSJ9LHsicGFnZSI6MywidHlwZSI6IlNSQ01BU1RFUkNBUkQifSx7InBhZ2UiOjQsInR5cGUiOiJTUkNBTUVYIn0seyJwYWdlIjo1LCJ0eXBlIjoiUEFORU5UUlkifV0sInBheW1lbnRDb25maWd1cmF0aW9ucyI6eyJTUkNWSVNBIjp7Im9yaWdpbiI6Imh0dHBzOi8vc2FuZGJveC1hc3NldHMuc2VjdXJlLmNoZWNrb3V0LnZpc2EuY29tIiwicGF0aCI6Ii9jaGVja291dC13aWRnZXQvcmVzb3VyY2VzL2pzL3NyYy1pLWFkYXB0ZXIvdmlzYVNkay5qcz92MiIsInBhbkVuY3J5cHRpb25LZXkiOnsia3R5IjoiUlNBIiwiZSI6IkFRQUIiLCJ1c2UiOiJlbmMiLCJraWQiOiJXMFBaOFZYVVZFQlU5NUpPNlpEWTEzc3E1Si1keFRuNTZmSWJEWDZObWMzWmo5V3FjIiwibiI6InNaUEl1c0RmN3lRbm5oQmtVOW11MTRWT08zQ3J1aTNiN3JBZjJLWWVvYlVSbVhBMTdiMUpYOWpnMENkLXZncG11eVRyeEJVU2MtNGIwLVVQZ1N3R0ZxUFdVcHgwOEV4cXJ3UERPdkZvakJvdTJ3bHlxOGJjeTBVcy1CZmVDelNFNWxNVmRTWFRYWFhjTnF1LXFiMjJqQ0NDSkFMcHhzQXJzYm9NT1hzTGVkaDNNNFhOUTVYR0F0UmY3Yi0tdVRZNURyOUtMWXlVdlpLQW5ZMDRNS0pQRU81NFlpSUZNNURUQWhOT21zMDg5amRNZHgtVVJJS0pqUFUyLVJwSEcxdThMQ0cwMjhSVElwUHNOYlJhbnVTNVRBWV96bHhEZ2IxaEtKMzZZYlpFTkhMZzlQWFRCaGRPTWxVOTBEVExsZmNiTFRhLUQ3RGdsakFhV0N1dnpMUGFHdyJ9LCJwYXJhbWV0ZXJzIjp7InNyY0luaXRpYXRvcklkIjoiSkZDWjhRVk9KQTc2TlhaNjhGWkQyMVJZSXhqM3lQWmRpVXhrZE51aWJCbHhnd2FQNCIsInNyY2lEcGFJZCI6ImEwMWVlMjBlLWE2ZTgtNDI3OC1iNGRmLTkxNTIyZjMyODg4NyIsInNyY2lUcmFuc2FjdGlvbklkIjoiNTNjMjk4NjAtMDQzNi00MTg0LWEwOTItY2I1NDk0ZWZhNDVhIiwiZHBhVHJhbnNhY3Rpb25PcHRpb25zIjp7ImRwYUxvY2FsZSI6ImVzX0NPIiwicGF5bG9hZFR5cGVJbmRpY2F0b3IiOiJGVUxMIiwicmV2aWV3QWN0aW9uIjoiY29udGludWUiLCJkcGFBY2NlcHRlZEJpbGxpbmdDb3VudHJpZXMiOltdLCJkcGFBY2NlcHRlZFNoaXBwaW5nQ291bnRyaWVzIjpbIlVTIiwiR0IiXSwiZHBhQmlsbGluZ1ByZWZlcmVuY2UiOiJBTEwiLCJkcGFTaGlwcGluZ1ByZWZlcmVuY2UiOiJOT05FIiwiY29uc3VtZXJOYW1lUmVxdWVzdGVkIjp0cnVlLCJjb25zdW1lckVtYWlsQWRkcmVzc1JlcXVlc3RlZCI6ZmFsc2UsImNvbnN1bWVyUGhvbmVOdW1iZXJSZXF1ZXN0ZWQiOmZhbHNlLCJtZXJjaGFudENvdW50cnlDb2RlIjoiQ08iLCJjdXN0b21JbnB1dERhdGEiOnsiY2hlY2tvdXRPcmNoZXN0cmF0b3IiOiJtZXJjaGFudCJ9LCJ0cmFuc2FjdGlvbkFtb3VudCI6eyJ0cmFuc2FjdGlvbkFtb3VudCI6IjIwMDAwIiwidHJhbnNhY3Rpb25DdXJyZW5jeUNvZGUiOiJDT1AifSwicGF5bWVudE9wdGlvbnMiOnsiZHBhRHluYW1pY0RhdGFUdGxNaW51dGVzIjoxNSwiZHBhUGFuUmVxdWVzdGVkIjpmYWxzZSwiZHluYW1pY0RhdGFUeXBlIjoiQ0FSRF9BUFBMSUNBVElPTl9DUllQVE9HUkFNX0xPTkdfRk9STSJ9fX19LCJTUkNNQVNURVJDQVJEIjp7Im9yaWdpbiI6Imh0dHBzOi8vc2FuZGJveC5zcmMubWFzdGVyY2FyZC5jb20iLCJwYXRoIjoiL3Nkay9zcmNzZGsubWFzdGVyY2FyZC5qcyIsInBhbkVuY3J5cHRpb25LZXkiOnsia3R5IjoiUlNBIiwiZSI6IkFRQUIiLCJ1c2UiOiJlbmMiLCJraWQiOiIyMDIzMDIwNzIyMzUyMS1zYW5kYm94LWZwYW4tZW5jcnlwdGlvbi1zcmMtbWFzdGVyY2FyZC1pbnQiLCJrZXlfb3BzIjpbImVuY3J5cHQiLCJ3cmFwS2V5Il0sImFsZyI6IlJTQS1PQUVQLTI1NiIsIm4iOiJ0MDZJOHNqbFMtcnJzN3VDYWdIOGV2b2V1bWFSb3ZLemlaU0k5UzJOOUlEUTl0VzJQYXBmUmE5TGMxS3ZlRUJEVnMyN1BraGtVNU95SGdQMGlFalR1S1Zwdmg1OVQ0bGEtbUJTSWxzN1VlY1VRTExhMFdrbWJ0TDdqTmRsdEE1ZnE3QWhjQXI1cWNhOTg4cXJMZDdJeXI5RTBDM1R4YlQ5dG8xaVFjcHo4b2NaT0RSWG9pZEZBbk9WTDVZR0ZtbHNyZURiSjRWaHNpMHBBZGNjUWNpbC15ZFNndXJLQi1ycUtwcGI5ZXBvbXU0UVVoMzM4MkN2OE5vYlltRjNvczhuR0dnR1AtY3lYbzBuc0tjUEFnZnJsUXpvczdxSHhVT3JGZTJ4X2xaMUcxQUUtWHJrcnhqQnlzOXE1M0dNUlNOQ1E4Yy1fbWNGOXBicTRIWUJzLXZENVEifSwicGFyYW1ldGVycyI6eyJzcmNpVHJhbnNhY3Rpb25JZCI6IjUzYzI5ODYwLTA0MzYtNDE4NC1hMDkyLWNiNTQ5NGVmYTQ1YSIsInNyY2lEcGFJZCI6ImEwMWVlMjBlLWE2ZTgtNDI3OC1iNGRmLTkxNTIyZjMyODg4NyIsInNyY0luaXRpYXRvcklkIjoiODQ0ZjdlM2QtMDdmMC00NGIxLWEyMzctZTY0MjQ0NGUwNTEyIiwiZHBhVHJhbnNhY3Rpb25PcHRpb25zIjp7InRyYW5zYWN0aW9uVHlwZSI6IlBVUkNIQVNFIiwiZHBhTG9jYWxlIjoiZXNfQ08iLCJkcGFBY2NlcHRlZFNoaXBwaW5nQ291bnRyaWVzIjpbIlVTIiwiR0IiXSwiY29uc3VtZXJFbWFpbEFkZHJlc3NSZXF1ZXN0ZWQiOmZhbHNlLCJjb25zdW1lclBob25lTnVtYmVyUmVxdWVzdGVkIjpmYWxzZSwidHJhbnNhY3Rpb25BbW91bnQiOnsidHJhbnNhY3Rpb25BbW91bnQiOiIyMDAwMCIsInRyYW5zYWN0aW9uQ3VycmVuY3lDb2RlIjoiQ09QIn0sImRwYUFjY2VwdGVkQmlsbGluZ0NvdW50cmllcyI6W10sImRwYUJpbGxpbmdQcmVmZXJlbmNlIjoiRlVMTCIsImRwYVNoaXBwaW5nUHJlZmVyZW5jZSI6Ik5PTkUiLCJjb25zdW1lck5hbWVSZXF1ZXN0ZWQiOnRydWUsInBheWxvYWRUeXBlSW5kaWNhdG9yIjoiRlVMTCIsInBheW1lbnRPcHRpb25zIjp7ImR5bmFtaWNEYXRhVHlwZSI6IkNBUkRfQVBQTElDQVRJT05fQ1JZUFRPR1JBTV9TSE9SVF9GT1JNIn19fX0sIlNSQ0FNRVgiOnsib3JpZ2luIjoiaHR0cHM6Ly9xd3d3LmFleHAtc3RhdGljLmNvbSIsInBhdGgiOiIvYWthbWFpL3JlbW90ZWNvbW1lcmNlL3NjcmlwdHMvYW1leFNESy0xLjAuMC5qcyIsInBhbkVuY3J5cHRpb25LZXkiOnsia3R5IjoiUlNBIiwiZSI6IkFRQUIiLCJ1c2UiOiJlbmMiLCJraWQiOiJzcmMtYW1leC1jYXJkLWVuYy0yMDI1IiwiYWxnIjoiUlNBLU9BRVAtMjU2IiwibiI6InZNS0IzNkl1a3pvd2pCSVV2LTFDUkxOcjJPcnZoX1NCbU9YV2swUVVJdW0yYmN6cEFFbFBFV3Z0djJRN245SzFhTjh2elloM01ZeUduSDY4YXY0Q1J4b054OFBZVklPZWZOM0hyVU1NUkNzNzRQc2NkcE00TU5VaHBmSF9TVmFsdjNLWUZSRGFaeGZvY2UxRERRVVRkcjRyWFJyOW9XNGlRSVZkX2ZKTkJpTElVN2ZtU0hEZGs3bFZxUWdoYVBMSlhUQzZ4elF6a2phM0FQdm5ma2VYRlV2aVVYNnZ3cW4yYkxDaldnSFZjZDFucktNTmpTMU4yaXdrMFF3WmVuZGx5clRIcGU1NXdhSDhseGdsaVBFTlc1SHpnZDUwUUd6RU1panFCd01VRndFalVidW1rZndSNHZQay1HNUF2U3NCVG5JRWJXWE81WmtqeWltQWYtM09LYjRoYkRFUS14enM4bGpBUE1RT0p5MEI5dXJfOEVfVDhXRHRHODhxcVZkY2xwRlZtSERycWJqc2NUUGNpNGRkQWRxVi1wcHdCczcwNDJjbDNpdEVab05wSjl5cU81T0tzY21jS2pTMUpIbGxlaVlDMjQ4dzVxM1BYWHJfUDNTT2ppdFdsaS1vT2xPdENZSF8ycTBFczZSbndkekNIT1U4WFpPd2tJdmNoUUFEIn0sInBhcmFtZXRlcnMiOnsic3JjaVRyYW5zYWN0aW9uSWQiOiI1M2MyOTg2MC0wNDM2LTQxODQtYTA5Mi1jYjU0OTRlZmE0NWEiLCJzcmNJbml0aWF0b3JJZCI6IjhlYzJjODg4LTY0Y2MtNGVmYy05MTc1LWIzMzc0NTJiMjhjOCIsImRwYURhdGEiOnsiZHBhTmFtZSI6IkdFVE5FVCBDSElMRSBTLkEuIiwiZHBhTG9nb1VyaSI6Imh0dHBzOi8vd3d3LmdldG5ldC5jbC8iLCJkcGFQcmVzZW50YXRpb25OYW1lIjoiR0VUTkVUIENISUxFIFMuQS4iLCJkcGFVcmkiOiJodHRwczovL3d3dy5nZXRuZXQuY2wvIn0sImRwYVRyYW5zYWN0aW9uT3B0aW9ucyI6eyJkcGFMb2NhbGUiOiJlc19DTyIsImRwYUFjY2VwdGVkQmlsbGluZ0NvdW50cmllcyI6W10sImRwYUFjY2VwdGVkU2hpcHBpbmdDb3VudHJpZXMiOlsiVVMiLCJHQiJdLCJkcGFCaWxsaW5nUHJlZmVyZW5jZSI6IkFMTCIsImRwYVNoaXBwaW5nUHJlZmVyZW5jZSI6Ik5PTkUiLCJjb25zdW1lck5hbWVSZXF1ZXN0ZWQiOnRydWUsImNvbnN1bWVyRW1haWxBZGRyZXNzUmVxdWVzdGVkIjpmYWxzZSwiY29uc3VtZXJQaG9uZU51bWJlclJlcXVlc3RlZCI6ZmFsc2UsInJldmlld0FjdGlvbiI6ImNvbnRpbnVlIiwidGhyZWVEc1ByZWZlcmVuY2UiOiJOT05FIn19fX0sImNhcHR1cmVNYW5kYXRlIjp7InNob3dDb25maXJtYXRpb25TdGVwIjp0cnVlLCJiaWxsaW5nVHlwZSI6IkZVTEwiLCJyZXF1ZXN0RW1haWwiOmZhbHNlLCJyZXF1ZXN0UGhvbmUiOmZhbHNlLCJyZXF1ZXN0U2hpcHBpbmciOmZhbHNlLCJzaGlwVG9Db3VudHJpZXMiOlsiVVMiLCJHQiJdLCJzaG93QWNjZXB0ZWROZXR3b3JrSWNvbnMiOnRydWV9LCJvcmRlckluZm9ybWF0aW9uIjp7ImFtb3VudERldGFpbHMiOnsidG90YWxBbW91bnQiOiIyMDAwMCIsImN1cnJlbmN5IjoiQ09QIn0sImJpbGxUbyI6eyJhZGRyZXNzMSI6IjkwMCBNZXRybyBDZW50ZXIgQmx2ZCIsImFkbWluaXN0cmF0aXZlQXJlYSI6IkNBIiwiYnVpbGRpbmdOdW1iZXIiOiIxIiwiY291bnRyeSI6IlVTIiwiZGlzdHJpY3QiOiJkaXN0cmljdCIsImxvY2FsaXR5IjoiRm9zdGVyIENpdHkiLCJwb3N0YWxDb2RlIjoiOTQ0MDQiLCJlbWFpbCI6Imp1YW5wYXBhYm9uQGdtYWlsLmNvbSIsImZpcnN0TmFtZSI6Ik1heWEiLCJsYXN0TmFtZSI6IlRyYW4iLCJtaWRkbGVOYW1lIjoiUyIsInRpdGxlIjoiTXMiLCJwaG9uZU51bWJlciI6IjMwMDY3MTkyMzUiLCJwaG9uZVR5cGUiOiJwaG9uZVR5cGUifX0sInRhcmdldE9yaWdpbnMiOlsiaHR0cHM6Ly9wb2MtbGVtb24tZml2ZS52ZXJjZWwuYXBwIl0sImlmcmFtZXMiOnsibWNlIjoiL21jZS9tY2UuaHRtbCIsImJ1dHRvbnMiOiIvYnV0dG9ubGlzdC9idXR0b25saXN0Lmh0bWwiLCJzcmMiOiIvc2VjdXJlLXJlbW90ZS1jb21tZXJjZS9zcmMuaHRtbCIsImN0cCI6Ii9jdHAvY3RwLmh0bWwiLCJnb29nbGVwYXkiOiIvZ29vZ2xlcGF5L2dvb2dsZXBheS5odG1sIiwiYXBwbGVwYXkiOiIvYXBwbGVwYXkvYXBwbGVwYXkuaHRtbCIsInBhemUiOiIvcGF6ZS9wYXplLmh0bWwiLCJjaGVjayI6Ii9jaGVjay9jaGVjay5odG1sIn0sImNsaWVudFZlcnNpb24iOiIwLjIyIiwiY291bnRyeSI6IkNPIiwibG9jYWxlIjoiZXNfQ08iLCJhbGxvd2VkQ2FyZE5ldHdvcmtzIjpbIlZJU0EiLCJNQVNURVJDQVJEIiwiQU1FWCJdLCJjciI6Imp6czJvZmJzemgwSm90Y0tEcmZ0dHliNlNJQ1BEOTFFM2hnaTlHTUpJY01VRm5KVG1SM1ZQdDVZRE02cU5IX2tFNmdBT3VPX25ybzFhdkZpTTQ1SFY1QXZlZUw0OUo2TEtwN1VRS3VRMUJYM1h1SFVKV3JHcHVuWiIsInNlcnZpY2VPcmlnaW4iOiJodHRwczovL3Rlc3R1cC5jeWJlcnNvdXJjZS5jb20iLCJjbGllbnRMaWJyYXJ5IjoiaHR0cHM6Ly90ZXN0dXAuY3liZXJzb3VyY2UuY29tL3VjL3YxL2Fzc2V0cy8wLjIyLjYvU2VjdXJlQWNjZXB0YW5jZS5qcyIsImxvZ2dpbmdQYXRoIjoiL3VjL3YxL2xvZy1ldmVudHMiLCJhc3NldHNQYXRoIjoiL3VjL3YxL2Fzc2V0cy8wLjIyLjYiLCJjbGllbnRMaWJyYXJ5SW50ZWdyaXR5Ijoic2hhMjU2LS8rMk91MndMYVU1eFhjaitJVTNsKzkzZk9UVENNNHhwQTQyNVhoejdnZEFcdTAwM2QifSwidHlwZSI6ImdkYS0wLjkuMCJ9XSwiaXNzIjoiRmxleCBBUEkiLCJleHAiOjE3NTYyNDQ5ODMsImlhdCI6MTc1NjI0NDA4MywianRpIjoiZGpVSHNPa2JsMGRyYW1RbCJ9.GyjVf0rfgNOPzoUv7OJUTJqkz7wtAeSSNFc8ve-T3z2c3glahYIKolbqLklElL8S9zaIAUjuVWnaR_3DsR6wEIVgVciPR9dRGIJhCoehYRCql20Ee7C73-oTmbRD1CjpX02zyda3h-l0ObvgbqzS-Ytof1TIE5zq_aGBZBMWGleP9ugeiyCywBu0H4Ub4EdArYXVxBRjmbHxxOE7TOQ7bx2iyzby7d8Jyib68Ba0KNo7sA5RTLkoqCavDK3ENrd4kMdEZL4MiPCmkDc-QsBTnlYi8O-gwpFNILzik1Zlc1WDANbITEVOIEfFwfWSCqNIxAaXcUkYq2DVRqvzyVKdmA';
  const showArgs = {
    containers: {
      paymentSelection: "#buttonPaymentListContainer"
    }
  };

  Accept(captureContext)
      .then(accept => accept.unifiedPayments())
      .then(up => up.show(showArgs))
      .then(tt => {
        const transientToken = document.getElementById('transientToken');
        transientToken.value = tt;

        console.log('tt:', tt);
      })
      .catch(error => {
        console.error("Error en el flujo de Click to Pay:", error);
      });

  console.log('cargado script de VISA Click to Pay');
};

onMounted(() => {
  console.log('Actualizado el 26 de agosto a las 04:35 pm')
  loadVisaClickToPay();
});
</script>