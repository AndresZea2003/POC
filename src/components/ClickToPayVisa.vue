<template>
  <div>
    <div id="buttonPaymentListContainer"></div>
    <textarea id="transientToken" name="transientToken" rows="25" cols="50"></textarea>
  </div>
</template>

<script setup>
import { onMounted } from 'vue';

const loadVisaClickToPay = async () => {
  console.log('Cargando script de VISA Click to Pay...');
  const script = document.createElement('script');

  // clientLibrary obtenido de la captura de contexto
  script.src = 'https://apitest.cybersource.com/up/v1/assets/0.22.0/SecureAcceptance.js';
  script.async = true;
  script.onload = await onVisaClickToPayLoaded;
  script.onerror = function() {
    console.error('Error al cargar el script de VISA Click to Pay.');
  };
  document.head.appendChild(script);
};

const onVisaClickToPayLoaded = async () => {
  const captureContext = 'eyJraWQiOiJ6dSIsImFsZyI6IlJTMjU2In0.eyJmbHgiOnsicGF0aCI6Ii9mbGV4L3YyL3Rva2VucyIsImRhdGEiOiJMaFVNdXBjeXRmclZ3d2NvNEdiU0pSQUFFQk1IQ2VYWHBxZDJHVlFXUUpDeDhmNzFOcnZDcnNQSDgwU1oxczhPTlhSaUNXZkFpeDR2cXRBV2xTUmZGbVhNcEpPS1hPc05uR25MMU9nK1JsQ3gvLzdIVWJnSWNkUWR2QmYyV1h3M2V2OTAvc2NwQzI1V0wvT2hNUWZQL0trOUpBXHUwMDNkXHUwMDNkIiwib3JpZ2luIjoiaHR0cHM6Ly90ZXN0ZmxleC5jeWJlcnNvdXJjZS5jb20iLCJqd2siOnsia3R5IjoiUlNBIiwiZSI6IkFRQUIiLCJ1c2UiOiJlbmMiLCJuIjoib1FFZ2NfQkE3cGMxZnRqRE83Z2s0MTFOaEd4RTVQd296RzRRSVlPLXpXU05zRnM5M0FrRENNZm1kcHo2QndXeXJZZ1hySy1Cc1dGMkU1TGVTcGFkck1tRkI5b2hxZXlJM0ZFUUExcF9kazRQXzlNOUViZHRmTlpIQ1YyejJmZ0hYSjBySUVyeEVQdjEzLWdja0FYYWxQdGdOeGo1MkxlbklpMi1rOEVFWlNCRkM0NmNMcjZRNmF5YS16bEpraDBjRVFfWGJwS0Rrb2QyN0tYNkZmMXV3UXJhandTbXRsbTR3b3A5RGZPZ0FyS2lyZmctbHNqQWxUSFVQS3lLbFNybWREbVhqemV3bW9rSjduV2UyUUxKOTI0eDNuWDBnT1pSUGgtT2pGRVE4cFJjTzY0VFJLcVo5bUVRTEZuM1ZDcWhUZ1pmbGlpTjZ2WDk2S0xMZjc4R2J3Iiwia2lkIjoiMDdpMVNaeFZsb0YyVXdJcXRvTjA1dmtNMmt4MldUYnoifX0sImN0eCI6W3siZGF0YSI6eyJhbGxvd2VkUGF5bWVudFR5cGVzIjpbeyJwYWdlIjoxLCJ0eXBlIjoiUEFORU5UUlkifSx7InBhZ2UiOjIsInR5cGUiOiJDTElDS1RPUEFZIn0seyJwYWdlIjozLCJ0eXBlIjoiU1JDVklTQSJ9LHsicGFnZSI6NCwidHlwZSI6IlNSQ01BU1RFUkNBUkQifSx7InBhZ2UiOjUsInR5cGUiOiJTUkNBTUVYIn1dLCJwYXltZW50Q29uZmlndXJhdGlvbnMiOnsiU1JDVklTQSI6eyJvcmlnaW4iOiJodHRwczovL3NhbmRib3gtYXNzZXRzLnNlY3VyZS5jaGVja291dC52aXNhLmNvbSIsInBhdGgiOiIvY2hlY2tvdXQtd2lkZ2V0L3Jlc291cmNlcy9qcy9zcmMtaS1hZGFwdGVyL3Zpc2FTZGsuanM_djIiLCJwYW5FbmNyeXB0aW9uS2V5Ijp7Imt0eSI6IlJTQSIsImUiOiJBUUFCIiwidXNlIjoiZW5jIiwia2lkIjoiM0dQV1BWSTNFU1czR0NKUzJZNUYxM2FlVVlsS1RWVGhYaVMyVEtuWUtFdExsLVFFTSIsIm4iOiJzWlBJdXNEZjd5UW5uaEJrVTltdTE0Vk9PM0NydWkzYjdyQWYyS1llb2JVUm1YQTE3YjFKWDlqZzBDZC12Z3BtdXlUcnhCVVNjLTRiMC1VUGdTd0dGcVBXVXB4MDhFeHFyd1BET3ZGb2pCb3Uyd2x5cThiY3kwVXMtQmZlQ3pTRTVsTVZkU1hUWFhYY05xdS1xYjIyakNDQ0pBTHB4c0Fyc2JvTU9Yc0xlZGgzTTRYTlE1WEdBdFJmN2ItLXVUWTVEcjlLTFl5VXZaS0FuWTA0TUtKUEVPNTRZaUlGTTVEVEFoTk9tczA4OWpkTWR4LVVSSUtKalBVMi1ScEhHMXU4TENHMDI4UlRJcFBzTmJSYW51UzVUQVlfemx4RGdiMWhLSjM2WWJaRU5ITGc5UFhUQmhkT01sVTkwRFRMbGZjYkxUYS1EN0RnbGpBYVdDdXZ6TFBhR3cifSwicGFyYW1ldGVycyI6eyJzcmNJbml0aWF0b3JJZCI6IkpGQ1o4UVZPSkE3Nk5YWjY4RlpEMjFSWUl4ajN5UFpkaVV4a2ROdWliQmx4Z3dhUDQiLCJzcmNpRHBhSWQiOiJhMDFlZTIwZS1hNmU4LTQyNzgtYjRkZi05MTUyMmYzMjg4ODciLCJzcmNpVHJhbnNhY3Rpb25JZCI6IjJmNGYwYWMyLTUwZTYtNDY2MS1iODIwLTY2ZDFmZWMyNzVhMSIsImRwYVRyYW5zYWN0aW9uT3B0aW9ucyI6eyJkcGFMb2NhbGUiOiJlc19DTyIsInBheWxvYWRUeXBlSW5kaWNhdG9yIjoiRlVMTCIsInJldmlld0FjdGlvbiI6ImNvbnRpbnVlIiwiZHBhQWNjZXB0ZWRCaWxsaW5nQ291bnRyaWVzIjpbXSwiZHBhQWNjZXB0ZWRTaGlwcGluZ0NvdW50cmllcyI6WyJVUyIsIkdCIl0sImRwYUJpbGxpbmdQcmVmZXJlbmNlIjoiQUxMIiwiZHBhU2hpcHBpbmdQcmVmZXJlbmNlIjoiTk9ORSIsImNvbnN1bWVyTmFtZVJlcXVlc3RlZCI6dHJ1ZSwiY29uc3VtZXJFbWFpbEFkZHJlc3NSZXF1ZXN0ZWQiOmZhbHNlLCJjb25zdW1lclBob25lTnVtYmVyUmVxdWVzdGVkIjpmYWxzZSwibWVyY2hhbnRDb3VudHJ5Q29kZSI6IkNPIiwiY3VzdG9tSW5wdXREYXRhIjp7ImNoZWNrb3V0T3JjaGVzdHJhdG9yIjoibWVyY2hhbnQifSwidHJhbnNhY3Rpb25BbW91bnQiOnsidHJhbnNhY3Rpb25BbW91bnQiOiIyMDAwMCIsInRyYW5zYWN0aW9uQ3VycmVuY3lDb2RlIjoiQ09QIn0sInBheW1lbnRPcHRpb25zIjp7ImRwYUR5bmFtaWNEYXRhVHRsTWludXRlcyI6MTUsImRwYVBhblJlcXVlc3RlZCI6ZmFsc2UsImR5bmFtaWNEYXRhVHlwZSI6IkNBUkRfQVBQTElDQVRJT05fQ1JZUFRPR1JBTV9MT05HX0ZPUk0ifX19fSwiU1JDTUFTVEVSQ0FSRCI6eyJvcmlnaW4iOiJodHRwczovL3NhbmRib3guc3JjLm1hc3RlcmNhcmQuY29tIiwicGF0aCI6Ii9zZGsvc3Jjc2RrLm1hc3RlcmNhcmQuanMiLCJwYW5FbmNyeXB0aW9uS2V5Ijp7Imt0eSI6IlJTQSIsImUiOiJBUUFCIiwidXNlIjoiZW5jIiwia2lkIjoiMjAyMzAyMDcyMjM1MjEtc2FuZGJveC1mcGFuLWVuY3J5cHRpb24tc3JjLW1hc3RlcmNhcmQtaW50Iiwia2V5X29wcyI6WyJlbmNyeXB0Iiwid3JhcEtleSJdLCJhbGciOiJSU0EtT0FFUC0yNTYiLCJuIjoidDA2SThzamxTLXJyczd1Q2FnSDhldm9ldW1hUm92S3ppWlNJOVMyTjlJRFE5dFcyUGFwZlJhOUxjMUt2ZUVCRFZzMjdQa2hrVTVPeUhnUDBpRWpUdUtWcHZoNTlUNGxhLW1CU0lsczdVZWNVUUxMYTBXa21idEw3ak5kbHRBNWZxN0FoY0FyNXFjYTk4OHFyTGQ3SXlyOUUwQzNUeGJUOXRvMWlRY3B6OG9jWk9EUlhvaWRGQW5PVkw1WUdGbWxzcmVEYko0VmhzaTBwQWRjY1FjaWwteWRTZ3VyS0ItcnFLcHBiOWVwb211NFFVaDMzODJDdjhOb2JZbUYzb3M4bkdHZ0dQLWN5WG8wbnNLY1BBZ2ZybFF6b3M3cUh4VU9yRmUyeF9sWjFHMUFFLVhya3J4akJ5czlxNTNHTVJTTkNROGMtX21jRjlwYnE0SFlCcy12RDVRIn0sInBhcmFtZXRlcnMiOnsic3JjaVRyYW5zYWN0aW9uSWQiOiIyZjRmMGFjMi01MGU2LTQ2NjEtYjgyMC02NmQxZmVjMjc1YTEiLCJzcmNpRHBhSWQiOiJhMDFlZTIwZS1hNmU4LTQyNzgtYjRkZi05MTUyMmYzMjg4ODciLCJzcmNJbml0aWF0b3JJZCI6Ijg0NGY3ZTNkLTA3ZjAtNDRiMS1hMjM3LWU2NDI0NDRlMDUxMiIsImRwYVRyYW5zYWN0aW9uT3B0aW9ucyI6eyJ0cmFuc2FjdGlvblR5cGUiOiJQVVJDSEFTRSIsImRwYUxvY2FsZSI6ImVzX0NPIiwiZHBhQWNjZXB0ZWRTaGlwcGluZ0NvdW50cmllcyI6WyJVUyIsIkdCIl0sImNvbnN1bWVyRW1haWxBZGRyZXNzUmVxdWVzdGVkIjpmYWxzZSwiY29uc3VtZXJQaG9uZU51bWJlclJlcXVlc3RlZCI6ZmFsc2UsInRyYW5zYWN0aW9uQW1vdW50Ijp7InRyYW5zYWN0aW9uQW1vdW50IjoiMjAwMDAiLCJ0cmFuc2FjdGlvbkN1cnJlbmN5Q29kZSI6IkNPUCJ9LCJkcGFBY2NlcHRlZEJpbGxpbmdDb3VudHJpZXMiOltdLCJkcGFCaWxsaW5nUHJlZmVyZW5jZSI6IkZVTEwiLCJkcGFTaGlwcGluZ1ByZWZlcmVuY2UiOiJOT05FIiwiY29uc3VtZXJOYW1lUmVxdWVzdGVkIjp0cnVlLCJwYXlsb2FkVHlwZUluZGljYXRvciI6IkZVTEwiLCJwYXltZW50T3B0aW9ucyI6eyJkeW5hbWljRGF0YVR5cGUiOiJDQVJEX0FQUExJQ0FUSU9OX0NSWVBUT0dSQU1fU0hPUlRfRk9STSJ9fX19LCJTUkNBTUVYIjp7Im9yaWdpbiI6Imh0dHBzOi8vcXd3dy5hZXhwLXN0YXRpYy5jb20iLCJwYXRoIjoiL2FrYW1haS9yZW1vdGVjb21tZXJjZS9zY3JpcHRzL2FtZXhTREstMS4wLjAuanMiLCJwYW5FbmNyeXB0aW9uS2V5Ijp7Imt0eSI6IlJTQSIsImUiOiJBUUFCIiwidXNlIjoiZW5jIiwia2lkIjoic3JjLWFtZXgtY2FyZC1lbmMtMjAyNCIsImFsZyI6IlJTQS1PQUVQLTI1NiIsIm4iOiJtRWswYm1MQzJaUVctYTRLWDFuRFkzWmZQTEZySDh0blV5SWI1a1RLZ3phZWFnaW1hSDRYcVA0WncwNWlpNk12ZHZOMFQycHlTSlE0am9raFBDMklXZW1pVlBHOGZDUEJNSnh4ankyRXU5b3RiaXdHUkJDZ3h3Y3UtYWNqWWF1cFZQdERON2VuZ0hEZG5PZ2FybG9HclBVTTZJRUVaV192RUI5Y1NyTV9CYThTY0M4UmFmZ05TWTgxaXhheFBBOGNPaEFBdnJMUTdLaEU1UXhTeklNZnJ6YjFMQllHTDRZUEJ1bmZOQTJ3M2Z2THdmQmwyXy1SRlJDVW1QRXYxTnVYcXhvMVJOMDhqMnVuOGVpY0d2bnQwZ3QtMjFuR3JiYzZ4cHA3cFpZMm9qLWhjMFpVbE55RV9rSnBMUzVPVVo4R2VPWnA0cVZSeGhrSVBHeEVlRi1RV2lTZzh1V2sxeDZuY3Rock1VSllWMUhQdTh0SGtKRG04QWEtRHNoUE5laXhEal9WRlZFUzhWLXlJSVJ3Zy1VMjgyV1BiMFQydEtSWGRuamxOdmNsQnNJXzRWd2c1Y1dFaFNrU3N6VUF5MVBDU0Zua1o1SUVPcmhnXzBUcGU3YWlPOHc1c1J3TmhablJwSnlJc1B0LWxNQ283enI4NUIydnhjb1BmZlNTcDNGWiJ9LCJwYXJhbWV0ZXJzIjp7InNyY2lUcmFuc2FjdGlvbklkIjoiMmY0ZjBhYzItNTBlNi00NjYxLWI4MjAtNjZkMWZlYzI3NWExIiwic3JjSW5pdGlhdG9ySWQiOiI4ZWMyYzg4OC02NGNjLTRlZmMtOTE3NS1iMzM3NDUyYjI4YzgiLCJkcGFEYXRhIjp7ImRwYU5hbWUiOiJHRVRORVQgQ0hJTEUgUy5BLiIsImRwYUxvZ29VcmkiOiJodHRwczovL3d3dy5nZXRuZXQuY2wvIiwiZHBhUHJlc2VudGF0aW9uTmFtZSI6IkdFVE5FVCBDSElMRSBTLkEuIiwiZHBhVXJpIjoiaHR0cHM6Ly93d3cuZ2V0bmV0LmNsLyJ9LCJkcGFUcmFuc2FjdGlvbk9wdGlvbnMiOnsiZHBhTG9jYWxlIjoiZXNfQ08iLCJkcGFBY2NlcHRlZEJpbGxpbmdDb3VudHJpZXMiOltdLCJkcGFBY2NlcHRlZFNoaXBwaW5nQ291bnRyaWVzIjpbIlVTIiwiR0IiXSwiZHBhQmlsbGluZ1ByZWZlcmVuY2UiOiJBTEwiLCJkcGFTaGlwcGluZ1ByZWZlcmVuY2UiOiJOT05FIiwiY29uc3VtZXJOYW1lUmVxdWVzdGVkIjp0cnVlLCJjb25zdW1lckVtYWlsQWRkcmVzc1JlcXVlc3RlZCI6ZmFsc2UsImNvbnN1bWVyUGhvbmVOdW1iZXJSZXF1ZXN0ZWQiOmZhbHNlLCJyZXZpZXdBY3Rpb24iOiJjb250aW51ZSIsInRocmVlRHNQcmVmZXJlbmNlIjoiTk9ORSJ9fX19LCJjYXB0dXJlTWFuZGF0ZSI6eyJiaWxsaW5nVHlwZSI6IkZVTEwiLCJyZXF1ZXN0RW1haWwiOmZhbHNlLCJyZXF1ZXN0UGhvbmUiOmZhbHNlLCJyZXF1ZXN0U2hpcHBpbmciOmZhbHNlLCJzaGlwVG9Db3VudHJpZXMiOlsiVVMiLCJHQiJdLCJzaG93QWNjZXB0ZWROZXR3b3JrSWNvbnMiOnRydWV9LCJvcmRlckluZm9ybWF0aW9uIjp7ImFtb3VudERldGFpbHMiOnsidG90YWxBbW91bnQiOiIyMDAwMCIsImN1cnJlbmN5IjoiQ09QIn19LCJ0YXJnZXRPcmlnaW5zIjpbImh0dHBzOi8vcG9jLWxlbW9uLWZpdmUudmVyY2VsLmFwcCJdLCJpZnJhbWVzIjp7Im1jZSI6Ii9tY2UvbWNlLmh0bWwiLCJidXR0b25zIjoiL2J1dHRvbmxpc3QvYnV0dG9ubGlzdC5odG1sIiwic3JjIjoiL3NlY3VyZS1yZW1vdGUtY29tbWVyY2Uvc3JjLmh0bWwiLCJjdHAiOiIvY3RwL2N0cC5odG1sIiwiZ29vZ2xlcGF5IjoiL2dvb2dsZXBheS9nb29nbGVwYXkuaHRtbCIsImFwcGxlcGF5IjoiL2FwcGxlcGF5L2FwcGxlcGF5Lmh0bWwiLCJwYXplIjoiL3BhemUvcGF6ZS5odG1sIiwiY2hlY2siOiIvY2hlY2svY2hlY2suaHRtbCJ9LCJjbGllbnRWZXJzaW9uIjoiMC4yMiIsImNvdW50cnkiOiJDTyIsImxvY2FsZSI6ImVzX0NPIiwiYWxsb3dlZENhcmROZXR3b3JrcyI6WyJWSVNBIiwiTUFTVEVSQ0FSRCIsIkFNRVgiXSwiY3IiOiJpNzRDV2xSM3JCdDBpR3hfUkU3clc4d3lLSTZHNmVRRFFYUUZUNllXTWplcDg4aW9XYVVGZlN2el9BeEt2OFRYSHpsT3VzSWt2dHhwdWVtNlhwdlVES05HdlV5d293aXlPNUp1cTFacFNuR0F6V3hIM2NmSlZwekEiLCJzZXJ2aWNlT3JpZ2luIjoiaHR0cHM6Ly9hcGl0ZXN0LmN5YmVyc291cmNlLmNvbSIsImNsaWVudExpYnJhcnkiOiJodHRwczovL2FwaXRlc3QuY3liZXJzb3VyY2UuY29tL3VwL3YxL2Fzc2V0cy8wLjIyLjEvU2VjdXJlQWNjZXB0YW5jZS5qcyIsImxvZ2dpbmdQYXRoIjoiL3VwL3YxL2xvZy1ldmVudHMiLCJhc3NldHNQYXRoIjoiL3VwL3YxL2Fzc2V0cy8wLjIyLjEiLCJjbGllbnRMaWJyYXJ5SW50ZWdyaXR5Ijoic2hhMjU2LXphRmNBUHN0NHg3emp1eHZ5QldldG5oYWRGczc4d21SMkhsaE5HR0ppU1lcdTAwM2QifSwidHlwZSI6ImdkYS0wLjkuMCJ9XSwiaXNzIjoiRmxleCBBUEkiLCJleHAiOjE3MjU5ODE3OTAsImlhdCI6MTcyNTk4MDg5MCwianRpIjoiQjRpZ2YwdnNDdUpmVVRocCJ9.SN5CBvfx1KBvupRwcikf9Zd3po2k2IOjXV3AwDePeQc9gBKOQHAE_c1D7hd8uTGE8cjjLXsXPP19rjjYoQmXLDWqsfpjocOKUECyC7WhMqM2MWKspVu9VsFCG4dSL_cfunqlbZz4xoHL_MwUFKiW0hsZutzMpRaVqqeW1mPxBXvbz259NI5mZbIEAq3lCR6zP_TkPoLWXky22fwaNKnXF-UqXPDvrptnZzYD0fLuRVJ1JphLkvlm1I2UoWDKhpjBGzMm9jSQTQu0ypacXmYPMyimc8rvM4tgJRBbb7IHnLrlsn8h4oleR4fcpYhm5nca6weOJptar4J3HlhLXPxl1A';
  const showArgs = {
    containers: {
      paymentSelection: "#buttonPaymentListContainer"
    }
  };

  Accept(captureContext)
      .then(accept => accept.unifiedPayments())
      .then(up => up.show(showArgs))
      .then(tt => {
        const transientToken = document.getElementById('transientToken');
        transientToken.value = tt;

        console.log('tt:', tt);
      })
      .catch(error => {
        console.error("Error en el flujo de Click to Pay:", error);
      });

  console.log('cargado script de VISA Click to Pay');
};

onMounted(() => {
  console.log('Actualizado el 10 de septiembre a las 10:08 am')
  loadVisaClickToPay();
});
</script>
